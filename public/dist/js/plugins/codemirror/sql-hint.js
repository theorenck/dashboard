!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],a):a(CodeMirror)}(function(a){"use strict";function b(b){var c=b.doc.modeOption;return"sql"===c&&(c="text/x-sql"),a.resolveMode(c).keywords}function c(a,b){var c=a.length,d=b.substr(0,c);return a.toUpperCase()===d.toUpperCase()}function d(a,b,d,e){for(var f in d)d.hasOwnProperty(f)&&(Array.isArray(d)&&(f=d[f]),c(b,f)&&a.push(e(f)))}function e(a,b){var c=b.getCursor(),e=b.getTokenAt(c),f="`"==e.string.charAt(0),g=e.string.substr(1),h=b.getTokenAt(n(c.line,e.start));if("."==e.string.charAt(0)||"."==h.string){if("."==h.string)var h=b.getTokenAt(n(c.line,e.start-1));var l=h.string,m=!1;l.match(/`/g)&&(m=!0,l=l.replace(/`/g,"")),j.hasOwnProperty(l)||(l=i(l,b));var o=j[l];if(!o)return;f?d(a,g,o,function(a){return"`"+a+"`"}):m?d(a,g,o,function(a){return".`"+a+"`"}):d(a,g,o,function(a){return"."+a})}else{for(;e.start&&"."==g.charAt(0);)e=b.getTokenAt(n(c.line,e.start-1)),g=e.string+g;f?(d(a,g,j,function(a){return"`"+a+"`"}),d(a,g,k,function(a){return"`"+a+"`"})):(d(a,g,j,function(a){return a}),d(a,g,k,function(a){return a}))}}function f(a,b){if(a)for(var c=/[,;]/g,d=a.split(" "),e=0;e<d.length;e++)b(d[e]?d[e].replace(c,""):"")}function g(a){return a.line+a.ch/Math.pow(10,6)}function h(a){return n(Math.floor(a),+a.toString().split(".").pop())}function i(a,b){for(var c=b.doc,d=c.getValue(),e=a.toUpperCase(),i="",k="",l=[],o={start:n(0,0),end:n(b.lastLine(),b.getLineHandle(b.lastLine()).length)},p=d.indexOf(m.QUERY_DIV);-1!=p;)l.push(c.posFromIndex(p)),p=d.indexOf(m.QUERY_DIV,p+1);l.unshift(n(0,0)),l.push(n(b.lastLine(),b.getLineHandle(b.lastLine()).text.length));for(var q=0,r=g(b.getCursor()),s=0;s<l.length;s++){var t=g(l[s]);if(r>=q&&t>=r){o={start:h(q),end:h(t)};break}q=t}for(var u=c.getRange(o.start,o.end,!1),s=0;s<u.length;s++){var v=u[s];if(f(v,function(a){a=a.trim();var b=a.toUpperCase();b===e&&j.hasOwnProperty(i)&&(k=i),b!==m.ALIAS_KEYWORD&&(i=a)}),k)break}return k}var j,k,l,m={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},n=a.Pos;a.registerHelper("hint","sql",function(a,c){j=c&&c.tables||{};var f=c&&c.defaultTable;k=f&&j[f]||[],l=l||b(a);var g,h,i,m=a.getCursor(),o=[],p=a.getTokenAt(m);return p.string.match(/^[.`\w@]\w*$/)?(i=p.string,g=p.start,h=p.end):(g=h=m.ch,i=""),"."==i.charAt(0)||"`"==i.charAt(0)?e(o,a):(d(o,i,j,function(a){return a}),d(o,i,k,function(a){return a}),d(o,i,l,function(a){return a.toUpperCase()})),{list:o,from:n(m.line,g),to:n(m.line,h)}})});