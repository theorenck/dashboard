!function(){"use strict";try{("undefined"==typeof Configuration.business_server||null===Configuration.business_server)&&alert("Por favor verifique seu arquivo de configuração, parece estar faltando alguns dados")}catch(Exception){console.log(Exception)}angular.module("Atlas",["ngResource","ngRoute","ui.codemirror","ui.bootstrap"]).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!0})}]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.useXDomain=!0,$httpProvider.defaults.headers.post["Content-Type"]="application/json",$httpProvider.interceptors.push("httpRequestInterceptor")}]).config(function($routeProvider){$routeProvider.when("/data-source-server",{controller:"DataSourceIndexController",templateUrl:"/dist/templates/data-source-server/index.html"}).when("/data-source-server/:action/:id?",{controller:"DataSourceCreateController",templateUrl:"/dist/templates/data-source-server/create.html"}).when("/dashboard",{controller:"DashboardIndexController",templateUrl:"/dist/templates/dashboard/index.html"}).when("/dashboard/:action/:id?",{controller:"DashboardCreateController",templateUrl:"/dist/templates/dashboard/create.html"}).when("/dashboards",{controller:"DashboardsController",templateUrl:"/dist/templates/dashboard-detail/dashboardsList.html"}).when("/dashboards/:id",{controller:"DashboardDetailController",templateUrl:"/dist/templates/dashboard-detail/dashboardDetail.html"}).when("/dashboards/v2/:id",{controller:"DashboardDetailController",templateUrl:"/dist/templates/dashboard-detail/dashboardDetail2.html"}).when("/indicator",{controller:"IndicatorIndexController",templateUrl:"/dist/templates/indicator/index.html"}).when("/indicator/:action/:id?",{controller:"IndicatorCreateController",templateUrl:"/dist/templates/indicator/create.html"}).when("/origem",{controller:"OrigemIndexController",templateUrl:"/dist/templates/origem/index.html"}).when("/origem/query/:id?",{controller:"QueryCreateController",templateUrl:"/dist/templates/origem/create-query.html"}).when("/origem/aggregation/:id?",{controller:"AggregationCreateController",templateUrl:"/dist/templates/origem/create-aggregation.html"}).when("/permission",{controller:"PermissionIndexController",templateUrl:"/dist/templates/permission/index.html"}).when("/permission/:action/:id?",{controller:"PermissionCreateController",templateUrl:"/dist/templates/permission/create.html"}).when("/widget",{controller:"WidgetIndexController",templateUrl:"/dist/templates/widget/index.html"}).when("/widget/:action/:id?",{controller:"WidgetCreateController",templateUrl:"/dist/templates/widget/create.html"}).when("/user",{controller:"UserIndexController",templateUrl:"/dist/templates/user/index.html"}).when("/user/:action/:id?",{controller:"UserCreateController",templateUrl:"/dist/templates/user/create.html"}).when("/console",{controller:"ConsoleController",templateUrl:"/dist/templates/console/console.html"}).otherwise({redirectTo:"/dashboards"})}).factory("httpRequestInterceptor",function(){return{request:function(config){var token=localStorage.getItem("token")||sessionStorage.getItem("token");return token&&(config.headers.Authorization="Token token="+token),config}}}).factory("zErrors",function(){return{handling:function(err){var messages=[];if(null===err)messages=["Conexão recusada"];else if("undefined"!==err.status&&500===err.status)messages=[err.statusText];else if("undefined"!==err.status&&0===err.status)messages=["Servidor indisponível"];else for(var index in err.errors)messages.push(index+": "+err.errors[index]);return messages}}}).filter("fromNow",function(){return function(date){return moment(date).fromNow()}})}(),function(){"use strict";function AppController($scope,$rootScope,$location,AuthService,zErrors){function errorHandler(err){$scope.alert={type:"danger",messages:zErrors.handling(err)}}function validateParams(credentials){return""!==credentials.username.trim()&&""!==credentials.password.trim()}$scope.credentials={username:"",password:""},$scope.open=!1,$scope.showResponsiveMenu=!0,$rootScope.$on("$routeChangeSuccess",function(){$scope.showResponsiveMenu=!0}),$scope.toggleResponsiveMenu=function(){$scope.showResponsiveMenu=!$scope.showResponsiveMenu},$scope.login=function(credentials){var authentication={authentication:credentials};validateParams(credentials)?AuthService.save(authentication,function(res){if(res.authentication&&res.authentication.token){var token=res.authentication.token;localStorage.setItem("token",token),localStorage.setItem("logged-in",!0),$location.path("/dashboards")}else localStorage.setItem("logged-in",!1)},errorHandler):$scope.alert={type:"warning",messages:["Desculpe, mas usuário e senha devem ser preenchidos"]}},$scope.logout=function(){localStorage.removeItem("token"),localStorage.removeItem("logged-in")},$scope.isLoggedIn=function(){return!!localStorage.getItem("logged-in")&&!!localStorage.getItem("token")||!1},$scope.range=function(num){return new Array(num)}}function DataSourceIndexController($scope,$location,DataSourceService){function renderList(){DataSourceService.get(function(data){$scope.serverList=data.data_source_servers})}$scope.serverList=[],renderList(),$scope.loadServer=function(id){$location.path("/data-source-server/update/"+id)},$scope.deleteServer=function(id,$index,$event){$event.preventDefault(),DataSourceService.remove({id:id},function(){$scope.renderList()})},$scope.renderList=function(){return renderList()}}function DataSourceCreateController(DataSourceService,$scope,$routeParams,$location){$scope.data_source_server={},$scope.cancelarApiServer=function(){$scope.data_source_server={}},$scope.saveApiServer=function(){var data={data_source_server:$scope.data_source_server};$scope.data_source_server.id?DataSourceService.update(data,function(){$location.path("/data-source-server/")}):DataSourceService.save(data,function(){$location.path("/data-source-server/")})},$routeParams.id&&DataSourceService.get({id:$routeParams.id},function(data){$scope.data_source_server=data.data_source_server})}function DashboardIndexController($scope,$location,DashboardService){function renderList(){DashboardService.get(function(data){$scope.dashboardList=data.dashboards})}$scope.dashboardList=[],renderList(),$scope.load=function(id){$location.path("/dashboard/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};DashboardService.remove(data,function(){$scope.renderList()})},$scope.renderList=function(){return renderList()}}function DashboardCreateController($scope,$routeParams,$location,DashboardService){$scope.dashboard={},$scope.salvar=function(){var data={dashboard:$scope.dashboard};$scope.dashboard.id?DashboardService.update(data,function(){$location.path("/dashboard/")}):DashboardService.save(data,function(){$location.path("/dashboard/")})},$scope.cancelar=function(){$scope.dashboard={}},$routeParams.id&&DashboardService.get({id:$routeParams.id},function(data){$scope.dashboard=data.dashboard})}function IndicatorIndexController($scope,$location,IndicatorService){$scope.indicatorList=[],$scope.renderList=function(){IndicatorService.get(function(data){$scope.indicatorList=data.indicators})},$scope.load=function(id){$location.path("/indicator/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};IndicatorService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function IndicatorCreateController($scope,$routeParams,$location,IndicatorService,SourceService,UnityService){$scope.sourceList=[],$scope.unityList=[],SourceService.get(function(data){$scope.sourceList=data.sources}),UnityService.get(function(data){$scope.unityList=data.unities}),$scope.salvar=function(){var data={indicator:$scope.indicator};$scope.indicator.id?IndicatorService.update(data,function(){$location.path("/indicator/")}):IndicatorService.save(data,function(){$location.path("/indicator/")})},$routeParams.id&&IndicatorService.get({id:$routeParams.id},function(data){$scope.indicator=data.indicator})}function WidgetIndexController($scope,$location,WidgetService){$scope.widget={},$scope.widgetList=[],$scope["delete"]=function(id,$index,$event){$event.preventDefault(),WidgetService.remove({id:id},function(){$scope.renderList()})},$scope.load=function(id){$location.path("/widget/update/"+id)},$scope.renderList=function(){WidgetService.get(function(data){$scope.widgetList=data.widgets})},$scope.renderList()}function WidgetCreateController($scope,$routeParams,$location,WidgetService,IndicatorService,DashboardService,WidgetTypeService){$scope.widget={},$scope.widgetList=[],IndicatorService.get(function(data){$scope.availableIndicators=data.indicators}),DashboardService.get(function(data){$scope.availableDashboards=data.dashboards}),WidgetTypeService.get(function(data){$scope.availableWidgetTypes=data.widget_types}),$routeParams.id&&WidgetService.get({id:$routeParams.id},function(data){$scope.widget=data.widget}),$scope.salvar=function(){var data={widget:$scope.widget};data.widget.indicator_id=$scope.widget.indicator.id,data.widget.widget_type_id=$scope.widget.widget_type.id,$scope.widget.id?WidgetService.update(data,function(){$location.path("/widget/")}):WidgetService.save(data,function(){$location.path("/widget/")})}}function UserIndexController($scope,$location,UserService){$scope.userList=[],$scope.renderList=function(){UserService.get(function(data){$scope.userList=data.users})},$scope.load=function(id){$location.path("user/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};UserService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function UserCreateController($scope,$routeParams,$location,UserService){$scope.user={},$scope.cancelar=function(){$scope.user={}},$scope.salvar=function(){var data={user:$scope.user};$scope.user.id?UserService.update(data,function(){$location.path("/user/")}):UserService.save(data,function(){$location.path("/user/")})},$routeParams.id&&UserService.get({id:$routeParams.id},function(data){$scope.user=data.user})}function PermissionIndexController($scope,$location,PermissionService){$scope.permissionList=[],$scope.renderList=function(){PermissionService.get(function(data){$scope.permissionList=data.permissions})},$scope.load=function(id){$location.path("permission/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};PermissionService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function PermissionCreateController($scope,$routeParams,$location,PermissionService,UserService,DataSourceService,DashboardService){$scope.permission={},$scope.availableUsers=[],$scope.availableDataSourceService=[],$scope.availableDashboards=[],UserService.get(function(data){$scope.availableUsers=data.users}),DataSourceService.get(function(data){$scope.availableDataSourceService=data.data_source_servers}),DashboardService.get(function(data){$scope.availableDashboards=data.dashboards}),$scope.salvar=function(){var data={permission:$scope.permission};$scope.permission.id?PermissionService.update(data,function(){$location.path("/permission/")}):PermissionService.save(data,function(){$location.path("/permission/")})},$routeParams.id&&PermissionService.get({id:$routeParams.id},function(data){$scope.permission=data.permission})}function ModalInstanceCtrl($scope,$modalInstance){$scope.cancel=function(){$modalInstance.dismiss("cancel")}}function ConsoleController($scope,$location,$anchorScroll,SourceService,StatementService,SchemaService,HistoryService,DataSourceService,zCodeMirror,$modal,zErrors){function getActiveDataSourceServer(){var el=_.find($scope.listDataSourceService,function(el){return!!el&&$scope.DataSource.activeDataSourceService===el.id});return el?(localStorage.setItem("activeDataSourceService",JSON.stringify(el)),el.url):!1}function prepareMessage(data,verbo){return 1===data?"01 registro "+verbo:0===data?"Nenhum registro "+verbo:data>0?data+" registros "+verbo+"s":void 0}function getStatementType(sql){return sql.match(/^\s*(SELECT|DELETE|UPDATE|INSERT|DROP|CREATE)\b/i)[1].toUpperCase()||""}function criaPaginacao(totalCols){var MAX_ITENS_PAGE=5e3,rowsPerPage=Math.floor(MAX_ITENS_PAGE/totalCols);return rowsPerPage}function verifyAllParamsFilled(sql,params){var paramsSql=sql.match(/:\w+/gi)||[];return paramsSql.length!==params.length?($scope.isExecuting=!1,$scope.alert={type:"danger",messages:["Desculpe, mas os parâmetros parecem estar incorretos."]},!1):!0}function createHint(data){var tables={};return data.schema.tables.forEach(function(val){tables[val.name]=[],val.columns.forEach(function(column){var hint=column.name+' <span class="hint-datatype">'+column.type+"("+column.length+")</span>";tables[val.name].push(hint)})}),localStorage.setItem("tables_"+$scope.DataSource.activeDataSourceService,JSON.stringify(tables)),tables}function showAlert(data){switch(getStatementType($scope.statement.sql)){case"SELECT":$scope.alert={type:"success",messages:[prepareMessage(data.resultset.rows.length,"encontrado")]};break;case"UPDATE":case"DELETE":case"INSERT":$scope.alert={type:"success",messages:[prepareMessage(data.resultset.records,"afetado")]},$scope.showResults=!1;break;case"CREATE":case"DROP":$scope.alert={type:"success",messages:["Sucesso na operação"]},$scope.showResults=!1}}$scope.allData=[],$scope.isOptionsOpened=!0,$scope.showParams=!0,$scope.showResults=!1,$scope.showExport=!1,$scope.data_types=["varchar","decimal","integer","date","time","timestamp"],$scope.isExecuting=!1,$scope.hasLimit=!0,$scope.results=[],$scope.currentPage=1,$scope.alert={},$scope.historyItems=[],$scope.editorOptions=zCodeMirror.initialize($scope),$scope.listDataSourceService=[],$scope.DataSource={activeDataSourceService:""},$scope.activeDataSourceService=null,$scope.collections={divisor:[{value:",",label:"Vírgula"},{value:";",label:"Ponto e Vírgula"},{value:"|",label:"Pipe"}],eol:[{value:"newline",label:"Em branco"},{value:";",label:"Ponto e Vírgula"},{value:",",label:"Vírgula"}]},$scope.exportModel={type:"json",csv:{divisor:",",eol:"newline"},consulta:{codigo:null,descricao:null}},$scope.resultset={records:0,fetched:0,columns:[],rows:[]};var codeMirror;DataSourceService.get(function(data){$scope.listDataSourceService=data.data_source_servers;var source=JSON.parse(localStorage.getItem("activeDataSourceService"))||{};$scope.DataSource.activeDataSourceService=source.id||data.data_source_servers[0].id}),$scope.scrollTop=function(){$anchorScroll()},$scope.open=function(size){$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:size})},$scope.codemirrorLoaded=function(_editor){codeMirror=_editor;var _doc=codeMirror.getDoc();codeMirror.focus(),_doc.markClean(),$scope.loadSchema()},$scope.loadSchema=function(){Configuration.middleware_server=getActiveDataSourceServer();var tables=localStorage.getItem("tables_"+$scope.DataSource.activeDataSourceService);Configuration.middleware_server&&(tables?(zCodeMirror.setHints(codeMirror,JSON.parse(tables)),codeMirror.refresh()):($scope.isLoadingSchema=!0,SchemaService.get({},Configuration.middleware_server).success(function(data){tables=createHint(data),zCodeMirror.setHints(codeMirror,tables),$scope.isLoadingSchema=!1}))),setTimeout(function(){codeMirror.refresh()},100)},$scope.validateParams=function(){var i;for(i=0;i<$scope.statement.parameters.length;i++){var param=$scope.statement.parameters[i];(""===param.name.trim()||""===param.value.trim())&&($scope.statement.parameters.splice(i,1),i--)}},$scope.resetStatement=function(){$scope.statement={parameters:[],sql:localStorage.getItem("draft")||"SELECT p.codproduto, p.codbarras, p.descricao1 FROM zw14ppro p WHERE p.situacao = 'N' LIMIT 1000"}},$scope.addParam=function(){$scope.statement.parameters.push({name:"",value:"",type:"varchar",evaluated:!1}),window.setTimeout(function(){$(".table-editable tr:last td:first input").focus()},1)},$scope.deleteParam=function(key){$scope.statement.parameters.splice(key,1)},$scope.deactiveResultsTab=function(){$scope.showResults=!1},$scope.executeQuery=function(currentPage,callback){if(Configuration.statement_server=getActiveDataSourceServer(),$scope.validateParams(),!$scope.isExecuting&&verifyAllParamsFilled($scope.statement.sql,$scope.statement.parameters))if($scope.isExecuting=!0,currentPage){for(var rowsPerPage=criaPaginacao($scope.result.columns.length),data=[],i=0,finalIndex=rowsPerPage*($scope.currentPage+1);finalIndex>i&&i<$scope.allData.length;)data[i]=$scope.allData[i],i++;$scope.result.rows=data,$scope.isExecuting=!1,$scope.currentPage++}else{var data={statement:$scope.statement},server=Configuration.statement_server;StatementService.execute(data,server).success(function(data){if($scope.saveHistory(),$scope.isExecuting=!1,"function"!=typeof callback&&($scope.showResults=!0),data.resultset){var rowsPerPage=criaPaginacao(data.resultset.columns.length);$scope.allData=data.resultset.rows,$scope.result={records:$scope.allData.length,columns:data.resultset.columns,rows:$scope.allData.slice(0,rowsPerPage)},showAlert(data)}"function"==typeof callback&&callback($scope.allData)}).error(function(err){$scope.isExecuting=!1,$scope.alert={type:"danger",messages:zErrors.handling(err)}})}},$scope.salvarOrigem=function(){if("consulta"===$scope.exportModel.type){$scope.statement.type="Query",$scope.statement.code=$scope.exportModel.consulta.codigo,$scope.statement.name=$scope.exportModel.consulta.descricao,$scope.statement.statement=$scope.statement.sql;var data={source:$scope.statement};SourceService.save(data,function(){$scope.resetStatement(),$scope.exportModel.consulta="",$scope.exportModel.codigo="",$scope.alert={type:"success",messages:["Origem salva com sucesso!"]}})}},$scope.saveHistory=function(){HistoryService.post($scope.statement,function(){$scope.renderHistory()})},$scope.loadHistoryItem=function(row){$scope.statement=row.statement},$scope.renderHistory=function(){HistoryService.get(function(data){$scope.historyItems=data,$scope.$$phase||$scope.$digest($scope)})},$scope["delete"]=function(id){HistoryService["delete"](id,function(data){$scope.historyItems=data})},$scope.clearHistory=function(){HistoryService.clear(function(){$scope.renderHistory()})},$scope.getStyleType=function(type){switch(type=type.toUpperCase()){case"SELECT":return"label-info";case"UPDATE":return"label-warning";case"INSERT":return"label-success";case"DELETE":return"label-danger";case"DROP":case"CREATE":return"label-default"}},$scope.$watch("statement.sql",function(newValue){localStorage.setItem("draft",newValue)}),$scope.resetStatement(),$scope.renderHistory()}function DashboardsController($scope,$location,DashboardService){$scope.dashboards=[],DashboardService.get(function(data){$scope.dashboards=data.dashboards}),$scope.loadDash=function(id){$location.path("/dashboards/"+id)}}function OrigemIndexController($scope,$location,SourceService){$scope.queriesList=[],$scope.renderList=function(){SourceService.get(function(data){$scope.queriesList=data.sources})},$scope.loadSource=function(type,id){var type=type.toLowerCase();$location.path("origem/"+type+"/"+id)},$scope.deleteQuery=function(id,$index,$event){$event.preventDefault();var data={id:id};window.confirm("Deseja deletar esse registro?")&&SourceService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function QueryCreateController($scope,$routeParams,$location,SourceService,zCodeMirror){$scope.showAdvancedOptions=!0,$scope.showResults=!1,$scope.data_types=["varchar","decimal","integer","date","time","timestamp"],$scope.isExecuting=!1,$scope.hasLimit=!0,$scope.results=[],$scope.currentPage=1,$scope.errors=[],$scope.historyItems=[],$scope.editorOptions=zCodeMirror.initialize($scope),$scope.codemirrorLoaded=function(_editor){var _doc=_editor.getDoc();_editor.focus(),_doc.markClean(),zCodeMirror.setHints(_editor,[])},$scope.save=function(){$scope.validateParams(),$scope.statement.type="Query";var data={source:$scope.statement};$scope.statement.id?SourceService.update(data,function(){$location.path("/origem/")}):SourceService.save(data,function(){$location.path("/origem/")})},$scope.validateParams=function(){for(var i=0;i<$scope.statement.parameters.length;i++){var param=$scope.statement.parameters[i];""===param.name.trim()&&($scope.statement.parameters.splice(i,1),i--)}},$scope.resetStatement=function(){$scope.statement={parameters:[],sql:"SELECT p.codproduto, p.codbarras, p.descricao1 FROM zw14ppro p WHERE p.situacao = 'N'",limit:100,offset:0},$scope.addParam()},$scope.addParam=function(){$scope.statement.parameters.push({name:"",value:null,evaluated:!1})},$scope.deleteParam=function(key){$scope.statement.parameters[key]._destroy=!0},isNaN($routeParams.id)?$scope.resetStatement():SourceService.get({id:$routeParams.id},function(data){$scope.statement=data.query})}function AggregationCreateController($scope,$routeParams,$location,SourceService,FunctionService){$scope.data_types=["varchar","decimal","integer","date","time","timestamp"],$scope.hasResult=!0,SourceService.get(function(data){$scope.sourceList=data.sources.filter(function(index){return"Query"===index.type?index:void 0})}),FunctionService.get(function(data){$scope.functionList=data.functions}),$scope.addOperation=function(){var data={function_id:null,name:null,parameters:[]};$scope.aggregation.executions.push(data)},$scope.addParamsToExecution=function(execution){var fnAux=_.find($scope.functionList,function(el){return console.log(el),el.id===execution.function_id?el:void 0}),params=[];fnAux.parameters.forEach(function(el){params.push({type:el.type,name:el.name})}),execution.parameters=params,execution.name=fnAux.name},$scope.addSource=function(){$scope.aggregation.sources.push({})},$scope.deleteParam=function(key){$scope.aggregation.parameters[key]._destroy=!0},$scope.deleteSource=function(key){$scope.aggregation.sources.splice(key,1)},$scope.save=function(){var data={source:$scope.aggregation};data.source.aggregated_sources=$scope.aggregation.sources.map(function(el){return{source_id:el.id}}),delete data.source.sources,$scope.aggregation.id?SourceService.update(data,function(){$location.path("/origem/")}):SourceService.save(data,function(){$location.path("/origem/")})},$scope.cancelar=function(){$location.path("/origem/")},isNaN($routeParams.id)?$scope.aggregation={type:"Aggregation",code:null,name:null,sources:[],executions:[]}:SourceService.get({id:$routeParams.id},function(data){$scope.aggregation=data.aggregation})}function DashboardDetailController($scope,$routeParams,$interval,DashboardService,SourceService,QueryService,AggregationService,zErrors){function loadDashboard(){DashboardService.get({id:$routeParams.id},function(data){$scope.dashboard=data.dashboard,$scope.dataSourceServer=data.dashboard.data_source_servers[0],$scope.dataSourceServer&&($scope.activeDataSourceServer=$scope.dataSourceServer.id,$scope.loadWidgets())},function(err){$scope.alert={type:"danger",messages:zErrors.handling(err)},$scope.isLoadingWidgets=!1})}function fillParameters(parameters){return _.each(parameters,function(el,index){null!==el.value&&""!==el.value.trim()||"inicio"!==el.name&&"fim"!==el.name?("inicio"===el.name||"fim"===el.name&&null!==el.value&&""===el.value.trim()&&el.evaluated===!0)&&(parameters[index].value=parameters[index].value.replace(":"+el.name,"'"+$scope.indicadores.periodo[el.name]+"'")):parameters[index].value="inicio"===el.name?$scope.indicadores.periodo.inicio:$scope.indicadores.periodo.fim}),parameters}function formatParameters(parameters){return _.each(parameters,function(el,index){parameters[index]={type:el.datatype,evaluated:el.evaluated||!1,name:el.name,value:el.value}}),parameters}function prepareAggregation(aggregation){var data={result:aggregation.result,statements:[],operations:[]};return aggregation.sources.forEach(function(s){data.statements.push({sql:s.statement,parameters:fillParameters(formatParameters(s.parameters))})}),aggregation.executions.forEach(function(operation){var params=operation.parameters.map(function(el){return isNaN(el.value)?el.value:parseInt(el.value)});data.operations.push({type:operation["function"].name,parameters:params})}),data}$scope.dashboard={},$scope.sourceList=[],$scope.dataSourceServer={},$scope.activeDataSourceServer,$scope.alert={},loadDashboard(),$scope.getStatus=function(result,widget){widget.full_result=result;var x=NumberHelpers.number_to_human(result,{labels:{thousand:"mil",million:"Mi",billion:"Bi",trillion:"Tri"},precision:3,significant:!0,separator:",",delimiter:"."});x=x.split(" "),widget.result=x[0],widget.grandeza=x[1]},$scope.prepareDataset=function(rows){for(var dataSet=[],dataAtual=moment($scope.indicadores.periodo.inicio).format("YYYY-MM-DD"),dataFinal=moment($scope.indicadores.periodo.fim).format("YYYY-MM-DD"),valores={values:[],labels:[],plotBands:[]};dataFinal>=dataAtual;){var row=_.find(rows,function(el){return el[0]===dataAtual});void 0===row&&(row=[dataAtual,0,0,0,0]),dataSet.push(row);var weekDay=moment(dataAtual).format("dd"),timestamp=parseInt(moment(row[0]).format("x"));valores.values.push([timestamp,row[1]]),"sáb"===weekDay&&valores.plotBands.push({from:moment(row[0]).format("x"),to:moment(row[0]).add(1,"day").format("x"),color:"rgba(192, 192, 192, .2)"}),dataAtual=moment(dataAtual).add(1,"day").format("YYYY-MM-DD")}return valores.values=valores.values.sort(function(a,b){return a[0]-b[0]}),valores},$scope.getGraph=function(widget,data){function grafico(valores){return window.dataset=valores.values,chart=new Highcharts.StockChart({colors:[Configuration.colors[widget.color]],title:{text:"<h3>"+title+"</h3>",useHtml:!0,style:{fontFamily:"Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif",fontSize:"19px"}},scrollbar:{enabled:!1},chart:{renderTo:$('[data-behaivor="widget"][data-id='+widget.id+"] .content")[0],zoomType:"x",panning:!0,panKey:"shift",events:{selection:function(event){$("[data-resetbutton]").css("display",event.xAxis?"block":"none")},load:function(){var buttons=this.rangeSelector.buttons;buttons.forEach(function(e){if($(e.element).click(function(){e.state&&3!==e.state&&$("[data-resetbutton]").css("display","block")}),e.state&&3===e.state){var t=e.element.childNodes[1],s="font-weight:normal;color:#FFF;fill:#FFF;";t.setAttribute("style",s),e.attr({opacity:.65})}})}}},navigation:{buttonOptions:{width:120}},navigator:{enabled:!1},credits:{enabled:!1},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},rangeSelector:{buttonTheme:{fill:"#3498DB",width:90,r:0,style:{background:"#3498DB",color:"#FFF"},states:{hover:{fill:"#217DBB",background:"#217DBB",style:{color:"white"}},select:{fill:"#217DBB",style:{color:"white",fontWeight:"normal"}}}},labelStyle:{display:"none"},inputEnabled:!1,buttons:[{type:"month",count:1,text:"1 mês"},{type:"month",count:3,text:"3 meses"},{type:"month",count:6,text:"6 meses"}]},plotOptions:{areaspline:{fillOpacity:.5},series:{states:{hover:{lineWidthPlus:10}}}},xAxis:{type:"datetime",minRange:12096e5,minTickInterval:864e5,plotBands:valores.plotBands,labels:{maxStaggerLines:1},dateTimeLabelFormats:{week:"%d/%b",day:"%d/%b",month:"%b/%Y"}},series:[{type:"areaspline",name:"Contratos",data:valores.values,lineWidth:2,marker:{enabled:!0,radius:3},tooltip:{valueDecimals:2}}]})}var chart,valores=$scope.prepareDataset(data.resultset.rows),title=widget.customized?widget.name:widget.indicator.name;try{$('[data-behaivor="widget"][data-id='+widget.id+"] .content").highcharts().destroy(),$(document).off("click","[data-resetbutton]")}catch(err){}chart=grafico(valores),$(document).on("click","[data-resetbutton]",function(){chart.zoomOut()})},$scope.getPie=function(widget,data){var colors=["#1abc9c","#2ecc71","#e74c3c","#e67e22","#f1c40f","#3498db","#9b59b6","#34495e","#95a5a6","#ecf0f1"].reverse(),dataset=[],percentual=0,total=0,title=widget.customized?widget.name:widget.indicator.name,serie="Quantidade",enabledTooltip=!0;if(widget.hasData=!0,data.resultset.rows.length>0){var volumeTotal=0,produtos=data.resultset.rows.sort(function(a,b){return a[1]>b[1]?-1:a[1]<b[1]?1:0}),produtosLength=produtos.length>=9?9:produtos.length;_.each(produtos,function(widget){volumeTotal+=widget[1]});for(var i=0;produtosLength>i;i++)percentual=100*produtos[i][1]/volumeTotal,dataset.push([$.trim(produtos[i][0].toUpperCase()),percentual]),total+=percentual;dataset.push(["OUTROS",100-total])}else widget.hasData=!1,dataset.push(["",100]),enabledTooltip=!1;$("[data-behaivor=widget][data-id="+widget.id+"] .content").highcharts({colors:colors,chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},legend:!1,plotOptions:{pie:{borderColor:"#FFF",innerSize:"60%",dataLabels:{enabled:!1},states:{hover:{enabled:enabledTooltip}}}},title:{text:title,useHtml:!0},tooltip:{enabled:enabledTooltip,pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},series:[{type:"pie",name:serie,data:dataset}]},function(chart){var xpos="50%",ypos="53%",circleradius=102;chart.renderer.circle(xpos,ypos,circleradius).attr({fill:"#fff"}).add()})},$scope.setActiveDataSourceServer=function(){$scope.dataSourceServer=_.find($scope.dashboard.data_source_servers,function(el){return $scope.activeDataSourceServer===el.id})},$scope.getHost=function(){var url=(new RegExp("https?://(.*:[0-9]{4})","i"),$scope.dataSourceServer.url);return url},$scope.loadWidgets=function(){var Service,parameters;if($scope.isLoadingWidgets=!0,0===Object.keys($scope.dashboard).length)loadDashboard();else{var widgetsLoaded=0;$scope.dashboard.widgets.forEach(function(widget){widget.loading=!0,SourceService.get({id:widget.indicator.source_id},function(data){$scope.alert={},data.query?(Service=QueryService,parameters=data.query.parameters,parameters=fillParameters(parameters),parameters=formatParameters(parameters)):(Service=AggregationService,data.aggregation=prepareAggregation(data.aggregation)),Service.post(data,$scope.getHost(),function(data){var type=widget.widget_type.name;switch(type){case"status":$scope.getStatus(data.resultset.rows[0][0]||0,widget);break;case"line":$scope.getGraph(widget,data);break;case"pie":$scope.getPie(widget,data)}widget.loading=!1,widgetsLoaded++,$scope.isLoadingWidgets=$scope.dashboard.widgets.length==widgetsLoaded?!1:!0})})})}},$scope.indicadores={periodo:{inicio:moment({day:1,month:10,year:2014}).format("YYYY-MM-DD 00:00:00"),fim:moment({day:30,month:10,year:2014}).format("YYYY-MM-DD 00:00:00"),duracao:function(grandeza){var grandeza=grandeza||"days",fim=moment($scope.indicadores.periodo.fim),inicio=moment($scope.indicadores.periodo.inicio),diferenca=fim.diff(inicio,grandeza);return diferenca+1}}}}angular.module("Atlas").controller("AppController",AppController).controller("DataSourceIndexController",DataSourceIndexController).controller("DataSourceCreateController",DataSourceCreateController).controller("DashboardIndexController",DashboardIndexController).controller("DashboardCreateController",DashboardCreateController).controller("IndicatorIndexController",IndicatorIndexController).controller("IndicatorCreateController",IndicatorCreateController).controller("WidgetIndexController",WidgetIndexController).controller("WidgetCreateController",WidgetCreateController).controller("UserIndexController",UserIndexController).controller("UserCreateController",UserCreateController).controller("PermissionIndexController",PermissionIndexController).controller("PermissionCreateController",PermissionCreateController).controller("ModalInstanceCtrl",ModalInstanceCtrl).controller("ConsoleController",ConsoleController).controller("OrigemIndexController",OrigemIndexController).controller("QueryCreateController",QueryCreateController).controller("AggregationCreateController",AggregationCreateController).controller("DashboardsController",DashboardsController).controller("DashboardDetailController",DashboardDetailController),AppController.$inject=["$scope","$rootScope","$location","AuthService","zErrors"],DataSourceIndexController.$inject=["$scope","$location","DataSourceService"],DataSourceCreateController.$inject=["DataSourceService","$scope","$routeParams","$location"],DashboardIndexController.$inject=["$scope","$location","DashboardService"],DashboardCreateController.$inject=["$scope","$routeParams","$location","DashboardService"],IndicatorIndexController.$inject=["$scope","$location","IndicatorService"],IndicatorCreateController.$inject=["$scope","$routeParams","$location","IndicatorService","SourceService","UnityService"],WidgetIndexController.$inject=["$scope","$location","WidgetService"],WidgetCreateController.$inject=["$scope","$routeParams","$location","WidgetService","IndicatorService","DashboardService","WidgetTypeService"],UserIndexController.$inject=["$scope","$location","UserService"],UserCreateController.$inject=["$scope","$routeParams","$location","UserService"],PermissionIndexController.$inject=["$scope","$location","PermissionService"],PermissionCreateController.$inject=["$scope","$routeParams","$location","PermissionService","UserService","DataSourceService","DashboardService"],ConsoleController.$inject=["$scope","$location","$anchorScroll","SourceService","StatementService","SchemaService","HistoryService","DataSourceService","zCodeMirror","$modal","zErrors"],DashboardsController.$inject=["$scope","$location","DashboardService"],OrigemIndexController.$inject=["$scope","$location","SourceService"],QueryCreateController.$inject=["$scope","$routeParams","$location","SourceService","zCodeMirror"],AggregationCreateController.$inject=["$scope","$routeParams","$location","SourceService","FunctionService","AggregationService"],DashboardDetailController.$inject=["$scope","$routeParams","$interval","DashboardService","SourceService","QueryService","AggregationService","zErrors"]
}(),function(){"use strict";angular.module("Atlas").directive("integer",function(){return{require:"ngModel",link:function(scope,ele,attr,ctrl){ctrl.$parsers.unshift(function(viewValue){return parseInt(viewValue,10)})}}}).directive("zJsondownload",function(){return{restrict:"EA",scope:{resultset:"=",columns:"=",typeFile:"@",options:"="},link:function(scope,el){function JSONDownload(JSONColumns,JSONData,reportTitle){var result={columns:[],resultset:[]};result.columns=JSONColumns,result.resultset=JSONData;try{var fileName="AtlasReport_";fileName+=reportTitle.replace(/ /g,"_");var uri="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(result)),link=document.createElement("a");link.href=uri,link.style="visibility:hidden",link.download=fileName+".json",document.body.appendChild(link),link.click(),document.body.removeChild(link)}catch(err){console.log(err)}}function JSONToCSVConvertor(JSONColumns,JSONData,reportTitle,showLabel){var CSV=[],eol="newline"===scope.options.csv.eol?"\r\n":scope.options.csv.eol+"\r\n";if(showLabel&&CSV.push(JSONColumns.join(scope.options.csv.divisor)),JSONData.forEach(function(row){row=row.join(scope.options.csv.divisor).replace(/(\r\n|\n|\r|\t|\s+)/gm," "),CSV.push(row)}),CSV=CSV.join(eol),""===CSV)return void alert("Invalid data");var fileName="AtlasReport_";fileName+=reportTitle.replace(/ /g,"_");var uri="data:text/csv;charset=utf-8,"+escape(CSV),link=document.createElement("a");link.href=uri,link.style="visibility:hidden",link.download=fileName+".csv",document.body.appendChild(link),link.click(),document.body.removeChild(link)}el.on("click",function(){"csv"===scope.typeFile?JSONToCSVConvertor(scope.columns,scope.resultset,"Console",!0):"json"===scope.typeFile&&JSONDownload(scope.columns,scope.resultset,"Console",!0)})}}}).directive("scrollPosition",function($window){return{scope:{scroll:"=scrollPosition"},link:function(scope){var windowEl=angular.element($window),handler=function(){scope.scroll=windowEl.scrollTop()};windowEl.on("scroll",scope.$apply.bind(scope,handler)),handler()}}}).directive("zCheckbox",function(){return{restrict:"E",require:"ngModel",scope:{checkbox:"=ngModel"},template:'<div class="atlCheckbox" ng-class="{\'atlCheckbox_checked\' : checkbox }"><input type="checkbox" ng-model="checkbox"></div>',link:function(scope,element){element.on({mouseenter:function(){element.children(1).addClass("atlCheckbox_hover")},focusin:function(){element.children(1).addClass("atlCheckbox_hover")},mouseleave:function(){element.children(1).removeClass("atlCheckbox_hover").removeClass(".atlCheckbox_active")},focusout:function(){element.children(1).removeClass("atlCheckbox_hover")}})}}}).directive("zExecutions",function(){return{restrict:"E",templateUrl:"/dist/templates/origem/zExecutions.html",link:function($scope){$scope.move=function(key,dir){$scope.aggregation.executions.map(function(elem,index){return elem.order=index,elem});for(var aux,i=0;i<$scope.aggregation.executions.length;i++){var index="down"===dir?i+1:i-1;key===i&&(aux=$scope.aggregation.executions[i],$scope.aggregation.executions[i]=$scope.aggregation.executions[index],$scope.aggregation.executions[index]=aux)}},$scope.deleteExecution=function(key){window.confirm("Você tem certeza que deseja deletar essa operação?")&&($scope.aggregation.executions[key].id?$scope.aggregation.executions[key]._destroy=!0:$scope.aggregation.executions.splice(key,1))},$scope.loadParametersFromFunction=function(execution){for(var i=0,fn=!1;i<$scope.functionList.length||fn===!1;)$scope.functionList[i].id===execution.function_id&&(fn=$scope.functionList[i]),i++;execution.parameters=fn.parameters}}}}).directive("zWidgetStatus",function(){return{restrict:"E",replace:!0,templateUrl:"/dist/templates/widget/tplStatus.html",link:function(){}}}).directive("zLoader",function(){return{restrict:"E",replace:!0,templateUrl:"/dist/templates/directives/zLoader.html",scope:{inverse:"="},link:function(){}}}).directive("zWidgetLine",function(){return{restrict:"E",templateUrl:"/dist/templates/widget/tplLine.html",link:function(){}}}).directive("zWidgetPie",function(){return{restrict:"E",templateUrl:"/dist/templates/widget/tplPie.html",link:function(){}}}).directive("zFloatthead",["$timeout",function($timeout){return{scope:{results:"=ngModel"},require:"ngModel",restrict:"EA",templateUrl:"/dist/templates/directives/zFloatThead.html",link:function($scope,iElm){function loadFloatThead(){$table=iElm.find(".floatThead"),$table.floatThead("destroy"),$timeout(function(){$table.floatThead({scrollContainer:function($table){return $table.closest(".wrapper")}})},500)}$scope.$watch("results",function(value){var records=value.records||0;records>0&&loadFloatThead()})}}}]).directive("zDaterangepicker",[function(){return{scope:{indicadores:"=ngModel",loadWidgets:"&callback"},require:"ngModel",restrict:"EA",link:function(scope,el){function verifyInputDate(){var i=document.createElement("input");return i.setAttribute("type","date"),"text"!==i.type}function callbackDatePicker(start,end,range){var text;if(void 0!==range&&"Personalizado"!==range)text=range;else{var formato="D [de] MMMM";start.format("YYYY")===end.format("YYYY")?start.format("MMMM")===end.format("MMMM")&&(formato="D"):formato="D [de] MMMM, YYYY",text=start.format(formato)+"  até  "+end.format("D [de] MMMM, YYYY")}$("[data-behaivor=show-actual-date]").html(text),scope.indicadores&&(scope.indicadores.periodo.inicio=start.format("YYYY-MM-DD 00:00:00"),scope.indicadores.periodo.fim=end.format("YYYY-MM-DD 00:00:00")),"function"==typeof scope.loadWidgets&&scope.loadWidgets()}var hasInputDate=verifyInputDate(),format=hasInputDate?"YYYY-MM-DD":"DD/MM/YYYY";el.daterangepicker({ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 Dias":[moment().subtract(6,"days"),moment()],"Últimos 30 Dias":[moment().subtract(29,"days"),moment()],"Últimos 90 Dias":[moment().subtract(89,"days"),moment()],"Este Mês":[moment().startOf("month"),moment().endOf("month")],"Último Mês":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},format:format,showDropdowns:!0,minDate:moment({year:2e3,month:0,day:1}),maxDate:moment().add(1,"month"),startDate:moment().subtract(29,"days"),endDate:moment(),locale:{applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Para",customRangeLabel:"Personalizado",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Favereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]}},callbackDatePicker),$(".daterangepicker").css("width",$(el).closest(".toolbar").innerWidth()-30+"px"),hasInputDate&&($("[name=daterangepicker_start]").attr("type","date"),$("[name=daterangepicker_end]").attr("type","date"))}}}]).directive("fastRepeat",["$timeout",function($timeout){return{restrict:"E",scope:{data:"="},link:function(scope,el){function loadFloatThead(records){records>0&&$timeout(function(){var $table=$(".table-float-thead");$table.floatThead("destroy"),$table.floatThead({scrollContainer:function($table){return $table.closest(".wrapper")}})},200)}scope.$watchCollection("data",function(newValue){if(newValue){var records=newValue.records||0;React.render(RTable(newValue),el[0],loadFloatThead(records))}}),el.on("$destroy",function(){var $table=el.find(".table-float-thead");$table.floatThead("destroy")})}}}]).factory("zCodeMirror",function(){var zCodeMirror={};return zCodeMirror.initialize=function($scope){return{lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete",F8:function(){$scope.executeQuery()},"Ctrl-S":function(){$scope.saveHistory()},"Ctrl-Enter":function(){$scope.executeQuery()},"Ctrl-L":function(e){function autoFormat(){var sql=e.doc.getValue();$.ajax({url:"http://sqlformat.org/api/v1/format",type:"POST",dataType:"json",crossDomain:!0,data:{sql:sql,reindent:1},success:function(data){e.doc.setValue(data.result)}})}autoFormat()}},tabSize:2,tabMode:"spaces",styleActiveLine:!1,matchBrackets:!0,mode:"text/x-sql",viewportMargin:1/0}},zCodeMirror.setHints=function(instance,tables){return instance.setOption("hintOptions",{tables:tables})},zCodeMirror}).directive("zAlertbox",[function(){return{scope:{alert:"=ngModel"},require:"ngModel",restrict:"EA",templateUrl:"/dist/templates/directives/zAlertbox.html",link:function($scope){$scope.clearMessages=function(){$scope.alert={type:"",messages:[]}}}}}])}(),function(){"use strict";angular.module("Atlas").service("zHttp",["$http",function($http){var http={url:"",req:{method:"GET",url:"http://localhost:3000",data:{}},setParams:function(method,data,server){"undefined"!=typeof method&&this.setMethod(method),"undefined"!=typeof data&&this.setData(data),"undefined"!=typeof server&&this.setServer(server)},setMethod:function(method){this.req.method=method},get:function(data,server,callback){var self=this;return self.setParams("GET",data,server),"function"==typeof callback?$http(self.req).success(callback):$http(self.req)},post:function(data,server,callback){var self=this;return self.setParams("POST",data,server),$http(self.req).success(callback)},setServer:function(server){var self=this;server="/"!==server.substr(-1)?server:server.substr(0,server.length-1),"undefined"!=typeof self.req.data.id&&(self.url+="/"+self.req.data.id),$.extend(self.req,{url:server+self.url})},setData:function(data){var self=this;if(data.query)var prepared={statement:{parameters:data.query.parameters,sql:data.query.statement}};else prepared=data;$.extend(self.req,{data:prepared})}};return http}]).factory("QueryService",["zHttp",function(zHttp){var x=Object.create(zHttp);return x.url="/api/statements",x}]).factory("AggregationService",["zHttp",function(zHttp){var x=Object.create(zHttp);return x.url="/api/aggregations",x}]).factory("SchemaService",["zHttp",function(zHttp){var x=Object.create(zHttp);return x.url="/api/schema/extended",x}]).factory("DataSourceService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/data_source_servers/:id",{id:"@data_source_server.id"},{update:{method:"PUT"}})}]).factory("SourceService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/sources/:id",{id:"@source.id"},{update:{method:"PUT"}})}]).factory("UnityService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/unities/:id",{id:"@unitiy.id"},{update:{method:"PUT"}})}]).factory("AuthService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/authentications/:id",{id:"@authentication.id"},{update:{method:"PUT"}})}]).factory("DashboardService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/dashboards/:id",{id:"@dashboard.id"},{update:{method:"PUT"}})}]).factory("IndicatorService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/indicators/:id",{id:"@indicator.id"},{update:{method:"PUT"}})}]).factory("WidgetService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/widgets/:id",{id:"@widget.id"},{update:{method:"PUT"}})}]).factory("UserService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/users/:id",{id:"@user.id"},{update:{method:"PUT"}})}]).factory("PermissionService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/permissions/:id",{id:"@permission.id"},{update:{method:"PUT"}})}]).factory("WidgetTypeService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/widget_types/:id",{id:"@widget_types.id"},{update:{method:"PUT"}})}]).factory("StatementService",["$http",function($http){var Statement={req:{method:"POST",url:"htpp://localhost:3000",data:{}},execute:function(data,server){var self=this;return self.setServer(server),self.setData(data),$http(self.req)},setServer:function(server){var self=this;$.extend(self.req,{url:server+"/api/statements"})},setData:function(data){var self=this;console.log(data),$.extend(self.req,{data:data})}};return Statement}]).factory("FunctionService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/functions")}]).factory("HistoryService",function(){var History={};return History.get=function(id,callback){var id=id||!1,items=JSON.parse(localStorage.getItem("history"))||[];if("function"==typeof id&&(callback=id,id=!1),id){for(var item=!1,i=0;i<items.length&&item===!1;)items[i].id===id&&(item=items[i]),i++;return item}callback(items)},History.post=function(statement,callback){var id=parseInt(16777215*Math.random(),10).toString(16),history=JSON.parse(localStorage.getItem("history"))||[],type=statement.sql.match(/^\s*(SELECT|DELETE|UPDATE|INSERT|DROP|CREATE)\b/i)[1].toUpperCase()||"",item={id:id,statement:statement,created_at:new Date,type:type};history.push(item),localStorage.setItem("history",JSON.stringify(history)),callback()},History.clear=function(callback){localStorage.removeItem("history"),callback()},History["delete"]=function(id,callback){for(var items=JSON.parse(localStorage.getItem("history"))||[],item=!1,i=0;i<items.length&&item===!1;)void 0!=items[i]&&items[i].id===id&&(items.splice(i,1),item=!0),i++;localStorage.setItem("history",JSON.stringify(items)),callback(items)},History})}();
//# sourceMappingURL=../sourcemap.map