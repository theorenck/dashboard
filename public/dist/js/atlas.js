!function(){"use strict";try{("undefined"==typeof Configuration.business_server||null===Configuration.business_server)&&alert("Por favor verifique seu arquivo de configuração, parece estar faltando alguns dados")}catch(Exception){console.log(Exception)}angular.module("Atlas",["ngResource","ngRoute","ui.codemirror","ui.bootstrap"]).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!0})}]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.useXDomain=!0,$httpProvider.interceptors.push("httpRequestInterceptor")}]).config(function($routeProvider){$routeProvider.when("/data-source-server",{controller:"DataSourceIndexController",templateUrl:"/dist/templates/data-source-server/index.html"}).when("/data-source-server/:action/:id?",{controller:"DataSourceCreateController",templateUrl:"/dist/templates/data-source-server/create.html"}).when("/dashboard",{controller:"DashboardIndexController",templateUrl:"/dist/templates/dashboard/index.html"}).when("/dashboard/:action/:id?",{controller:"DashboardCreateController",templateUrl:"/dist/templates/dashboard/create.html"}).when("/dashboards",{controller:"DashboardsController",templateUrl:"/dist/templates/dashboard-detail/dashboardsList.html"}).when("/dashboards/12",{controller:"DashboardFakeDetailController",templateUrl:"/dist/templates/dashboard-detail/dashboardFakeDetail.html"}).when("/dashboards/:id",{controller:"DashboardDetailController",templateUrl:"/dist/templates/dashboard-detail/dashboardDetail.html"}).when("/dashboards/v2/:id",{controller:"DashboardDetailController",templateUrl:"/dist/templates/dashboard-detail/dashboardDetail2.html"}).when("/indicator",{controller:"IndicatorIndexController",templateUrl:"/dist/templates/indicator/index.html"}).when("/indicator/:action/:id?",{controller:"IndicatorCreateController",templateUrl:"/dist/templates/indicator/create.html"}).when("/origem",{controller:"OrigemIndexController",templateUrl:"/dist/templates/origem/index.html"}).when("/origem/query/:id?",{controller:"QueryCreateController",templateUrl:"/dist/templates/origem/create-query.html"}).when("/origem/aggregation/:id?",{controller:"AggregationCreateController",templateUrl:"/dist/templates/origem/create-aggregation.html"}).when("/permission",{controller:"PermissionIndexController",templateUrl:"/dist/templates/permission/index.html"}).when("/permission/:action/:id?",{controller:"PermissionCreateController",templateUrl:"/dist/templates/permission/create.html"}).when("/widget",{controller:"WidgetIndexController",templateUrl:"/dist/templates/widget/index.html"}).when("/widget/:action/:id?",{controller:"WidgetCreateController",templateUrl:"/dist/templates/widget/create.html"}).when("/user",{controller:"UserIndexController",templateUrl:"/dist/templates/user/index.html"}).when("/user/:action/:id?",{controller:"UserCreateController",templateUrl:"/dist/templates/user/create.html"}).when("/console",{controller:"ConsoleController",templateUrl:"/dist/templates/console/console.html"}).otherwise({redirectTo:"/dashboards"})}).factory("httpRequestInterceptor",function(){return{request:function(config){var token=localStorage.getItem("token")||sessionStorage.getItem("token");return token&&(config.headers.Authorization="Token token="+token),config}}}).factory("zErrors",function(){return{handling:function(err){var messages=[];if(null===err)messages=["Conexão recusada"];else if("undefined"!==err.status&&500===err.status)messages=[err.statusText];else if("undefined"!==err.status&&0===err.status)messages=["Servidor indisponível"];else for(var index in err.errors)messages.push(index+": "+err.errors[index]);return messages}}}).filter("fromNow",function(){return function(date){return moment(date).fromNow()}})}(),function(){"use strict";function AppController($scope,$rootScope,$location,AuthService,zErrors){function errorHandler(err){$scope.alert={type:"danger",messages:zErrors.handling(err)}}function validateParams(credentials){return""!==credentials.username.trim()&&""!==credentials.password.trim()}$scope.credentials={username:"",password:""},$scope.open=!1,$scope.showResponsiveMenu=!0,$rootScope.$on("$routeChangeSuccess",function(){$scope.showResponsiveMenu=!0}),$scope.toggleResponsiveMenu=function(){$scope.showResponsiveMenu=!$scope.showResponsiveMenu},$scope.login=function(credentials){var authentication={authentication:credentials};validateParams(credentials)?AuthService.save(authentication,function(res){if(res.authentication&&res.authentication.token){var token=res.authentication.token;localStorage.setItem("token",token),localStorage.setItem("logged-in",!0),$location.path("/dashboards")}else localStorage.setItem("logged-in",!1)},errorHandler):$scope.alert={type:"warning",messages:["Desculpe, mas usuário e senha devem ser preenchidos"]}},$scope.logout=function(){localStorage.removeItem("token"),localStorage.removeItem("logged-in")},$scope.isLoggedIn=function(){return!!localStorage.getItem("logged-in")&&!!localStorage.getItem("token")||!1},$scope.range=function(num){return new Array(num)}}function DataSourceIndexController($scope,$location,DataSourceService){function renderList(){DataSourceService.get(function(data){$scope.serverList=data.data_source_servers})}$scope.serverList=[],renderList(),$scope.loadServer=function(id){$location.path("/data-source-server/update/"+id)},$scope.deleteServer=function(id,$index,$event){$event.preventDefault(),DataSourceService.remove({id:id},function(){$scope.renderList()})},$scope.renderList=function(){return renderList()}}function DataSourceCreateController(DataSourceService,$scope,$routeParams,$location){$scope.data_source_server={},$scope.cancelarApiServer=function(){$scope.data_source_server={}},$scope.saveApiServer=function(){var data={data_source_server:$scope.data_source_server};$scope.data_source_server.id?DataSourceService.update(data,function(){$location.path("/data-source-server/")}):DataSourceService.save(data,function(){$location.path("/data-source-server/")})},$routeParams.id&&DataSourceService.get({id:$routeParams.id},function(data){$scope.data_source_server=data.data_source_server})}function DashboardIndexController($scope,$location,DashboardService){function renderList(){DashboardService.get(function(data){$scope.dashboardList=data.dashboards})}$scope.dashboardList=[],renderList(),$scope.load=function(id){$location.path("/dashboard/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};DashboardService.remove(data,function(){$scope.renderList()})},$scope.renderList=function(){return renderList()}}function DashboardCreateController($scope,$routeParams,$location,DashboardService){$scope.dashboard={},$scope.salvar=function(){var data={dashboard:$scope.dashboard};$scope.dashboard.id?DashboardService.update(data,function(){$location.path("/dashboard/")}):DashboardService.save(data,function(){$location.path("/dashboard/")})},$scope.cancelar=function(){$scope.dashboard={}},$routeParams.id&&DashboardService.get({id:$routeParams.id},function(data){$scope.dashboard=data.dashboard})}function IndicatorIndexController($scope,$location,IndicatorService){$scope.indicatorList=[],$scope.renderList=function(){IndicatorService.get(function(data){$scope.indicatorList=data.indicators})},$scope.load=function(id){$location.path("/indicator/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};IndicatorService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function IndicatorCreateController($scope,$routeParams,$location,IndicatorService,SourceService,UnityService){$scope.sourceList=[],$scope.unityList=[],SourceService.get(function(data){$scope.sourceList=data.sources}),UnityService.get(function(data){$scope.unityList=data.unities}),$scope.salvar=function(){var data={indicator:$scope.indicator};$scope.indicator.id?IndicatorService.update(data,function(){$location.path("/indicator/")}):IndicatorService.save(data,function(){$location.path("/indicator/")})},$routeParams.id&&IndicatorService.get({id:$routeParams.id},function(data){$scope.indicator=data.indicator})}function WidgetIndexController($scope,$location,WidgetService){$scope.widget={},$scope.widgetList=[],$scope["delete"]=function(id,$index,$event){$event.preventDefault(),WidgetService.remove({id:id},function(){$scope.renderList()})},$scope.load=function(id){$location.path("/widget/update/"+id)},$scope.renderList=function(){WidgetService.get(function(data){$scope.widgetList=data.widgets})},$scope.renderList()}function WidgetCreateController($scope,$routeParams,$location,WidgetService,IndicatorService,DashboardService,WidgetTypeService){$scope.widget={},$scope.widgetList=[],IndicatorService.get(function(data){$scope.availableIndicators=data.indicators}),DashboardService.get(function(data){$scope.availableDashboards=data.dashboards}),WidgetTypeService.get(function(data){$scope.availableWidgetTypes=data.widget_types}),$routeParams.id&&WidgetService.get({id:$routeParams.id},function(data){$scope.widget=data.widget}),$scope.salvar=function(){var data={widget:$scope.widget};data.widget.indicator_id=$scope.widget.indicator.id,data.widget.widget_type_id=$scope.widget.widget_type.id,$scope.widget.id?WidgetService.update(data,function(){$location.path("/widget/")}):WidgetService.save(data,function(){$location.path("/widget/")})}}function UserIndexController($scope,$location,UserService){$scope.userList=[],$scope.renderList=function(){UserService.get(function(data){$scope.userList=data.users})},$scope.load=function(id){$location.path("user/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};UserService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function UserCreateController($scope,$routeParams,$location,UserService){$scope.user={},$scope.cancelar=function(){$scope.user={}},$scope.salvar=function(){var data={user:$scope.user};$scope.user.id?UserService.update(data,function(){$location.path("/user/")}):UserService.save(data,function(){$location.path("/user/")})},$routeParams.id&&UserService.get({id:$routeParams.id},function(data){$scope.user=data.user})}function PermissionIndexController($scope,$location,PermissionService){$scope.permissionList=[],$scope.renderList=function(){PermissionService.get(function(data){$scope.permissionList=data.permissions})},$scope.load=function(id){$location.path("permission/update/"+id)},$scope["delete"]=function(id,$index,$event){$event.preventDefault();var data={id:id};PermissionService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function PermissionCreateController($scope,$routeParams,$location,PermissionService,UserService,DataSourceService,DashboardService){$scope.permission={},$scope.availableUsers=[],$scope.availableDataSourceService=[],$scope.availableDashboards=[],UserService.get(function(data){$scope.availableUsers=data.users}),DataSourceService.get(function(data){$scope.availableDataSourceService=data.data_source_servers}),DashboardService.get(function(data){$scope.availableDashboards=data.dashboards}),$scope.salvar=function(){var data={permission:$scope.permission};$scope.permission.id?PermissionService.update(data,function(){$location.path("/permission/")}):PermissionService.save(data,function(){$location.path("/permission/")})},$routeParams.id&&PermissionService.get({id:$routeParams.id},function(data){$scope.permission=data.permission})}function ModalInstanceCtrl($scope,$modalInstance){$scope.cancel=function(){$modalInstance.dismiss("cancel")}}function ConsoleController($scope,$location,$anchorScroll,StatementService,SchemaService,HistoryService,DataSourceService,zCodeMirror,$modal,zErrors){function getActiveDataSourceServer(){var el=_.find($scope.listDataSourceService,function(el){return $scope.activeDataSourceService===el.id});return el.url}function getStatementType(sql){return sql.match(/^\s*(SELECT|DELETE|UPDATE|INSERT|DROP|CREATE)\b/i)[1].toUpperCase()||""}function resetAlert(){$scope.alert={type:"info",messages:[]}}function criaPaginacao(totalCols){var MAX_ITENS_PAGE=5e3,rowsPerPage=Math.floor(MAX_ITENS_PAGE/totalCols);return rowsPerPage}var allData=[];$scope.showAdvancedOptions=!0,$scope.showResults=!1,$scope.data_types=["varchar","decimal","integer","date","time","timestamp"],$scope.isExecuting=!1,$scope.hasLimit=!0,$scope.results=[],$scope.currentPage=1,$scope.alert={},$scope.historyItems=[],$scope.editorOptions=zCodeMirror.initialize($scope),$scope.listDataSourceService=[],$scope.resultset={records:0,fetched:0,columns:[],rows:[]},$scope.scrollTop=function(){$location.hash("top"),$anchorScroll()},$scope.open=function(size){$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:size})},DataSourceService.get(function(data){$scope.listDataSourceService=data.data_source_servers,$scope.activeDataSourceService=data.data_source_servers[0].id}),$scope.codemirrorLoaded=function(_editor){var _doc=_editor.getDoc();_editor.focus(),_doc.markClean(),zCodeMirror.setHints(_editor),localStorage.getItem("tables")||SchemaService.get(function(data){var tables={};data.schema.tables.forEach(function(val){tables[val.name]=[],val.columns.forEach(function(column){var hint=column.name+' <span class="hint-datatype">'+column.type+"("+column.length+")</span>";tables[val.name].push(hint)})}),localStorage.setItem("tables",JSON.stringify(tables)),zCodeMirror.setHints(_editor,tables)})},$scope.validateParams=function(){var i;for(i=0;i<$scope.statement.parameters.length;i++){var param=$scope.statement.parameters[i];(""===param.name.trim()||""===param.value.trim())&&($scope.statement.parameters.splice(i,1),i--)}},$scope.resetStatement=function(){$scope.statement={parameters:[],sql:localStorage.getItem("draft")||"SELECT p.codproduto, p.codbarras, p.descricao1 FROM zw14ppro p WHERE p.situacao = 'N' LIMIT 1000"},$scope.addParam()},$scope.addParam=function(){$scope.statement.parameters.push({name:"",value:"",type:"varchar",evaluated:!1})},$scope.deleteParam=function(key){$scope.statement.parameters.splice(key,1)},$scope.executeQuery=function(currentPage){function prepareMessage(data,verbo){return 1===data?"01 registro "+verbo:0===data?"Nenhum registro "+verbo:data>0?data+" registros "+verbo+"s":void 0}if(Configuration.statement_server=getActiveDataSourceServer(),resetAlert(),!$scope.isExecuting){if($scope.validateParams(),$scope.isExecuting=!0,currentPage){for(var rowsPerPage=criaPaginacao($scope.result.columns.length),data=[],i=0,finalIndex=rowsPerPage*($scope.currentPage+1);finalIndex>i&&i<allData.length;)data[i]=allData[i],i++;return $scope.result.rows=data,$scope.isExecuting=!1,void $scope.currentPage++}var data={statement:$scope.statement},server=Configuration.statement_server;StatementService.execute(data,server).success(function(data){if($scope.saveHistory(),$scope.isExecuting=!1,$scope.showResults=!0,data.result){var rowsPerPage=criaPaginacao(data.result.columns.length);allData=data.result.rows,$scope.result={records:allData.length,columns:data.result.columns,rows:allData.slice(0,rowsPerPage)}}switch(getStatementType($scope.statement.sql)){case"SELECT":$scope.alert={type:"success",messages:[prepareMessage(data.result.rows.length,"encontrado")]};break;case"UPDATE":case"DELETE":case"INSERT":$scope.alert={type:"success",messages:[prepareMessage(data.result.records,"afetado")]},$scope.showResults=!1;break;case"CREATE":case"DROP":$scope.alert={type:"success",messages:["Sucesso na operação"]},$scope.showResults=!1}}).error(function(err){$scope.isExecuting=!1,$scope.alert={type:"danger",messages:zErrors.handling(err)}})}},$scope.saveHistory=function(){HistoryService.post($scope.statement,function(){$scope.renderHistory()})},$scope.loadHistoryItem=function(row){$scope.statement=row.statement},$scope.renderHistory=function(){HistoryService.get(function(data){$scope.historyItems=data,$scope.$$phase||$scope.$digest($scope)})},$scope["delete"]=function(id){HistoryService["delete"](id,function(data){$scope.historyItems=data})},$scope.clearHistory=function(){HistoryService.clear(function(){$scope.renderHistory()})},$scope.getStyleType=function(type){switch(type=type.toUpperCase()){case"SELECT":return"label-info";case"UPDATE":return"label-warning";case"INSERT":return"label-success";case"DELETE":return"label-danger";case"DROP":case"CREATE":return"label-default"}},$scope.$watch("statement.sql",function(newValue){localStorage.setItem("draft",newValue)}),$scope.resetStatement(),$scope.renderHistory()}function DashboardsController($scope,$location,DashboardService){$scope.dashboards=[],DashboardService.get(function(data){$scope.dashboards=data.dashboards}),$scope.loadDash=function(id){$location.path("/dashboards/"+id)}}function OrigemIndexController($scope,$location,SourceService){$scope.queriesList=[],$scope.renderList=function(){SourceService.get(function(data){$scope.queriesList=data.sources})},$scope.loadSource=function(type,id){var type=type.toLowerCase();$location.path("origem/"+type+"/"+id)},$scope.deleteQuery=function(id,$index,$event){$event.preventDefault();var data={id:id};window.confirm("Deseja deletar esse registro?")&&SourceService.remove(data,function(){$scope.renderList()})},$scope.renderList()}function QueryCreateController($scope,$routeParams,$location,SourceService,zCodeMirror){$scope.showAdvancedOptions=!0,$scope.showResults=!1,$scope.data_types=["varchar","decimal","integer","date","time","timestamp"],$scope.isExecuting=!1,$scope.hasLimit=!0,$scope.results=[],$scope.currentPage=1,$scope.errors=[],$scope.historyItems=[],$scope.editorOptions=zCodeMirror.initialize($scope),$scope.codemirrorLoaded=function(_editor){var _doc=_editor.getDoc();_editor.focus(),_doc.markClean(),zCodeMirror.setHints(_editor),localStorage.getItem("tables")||SchemaService.get(function(data){localStorage.setItem("tables",JSON.stringify(data.schema.tables)),zCodeMirror.setHints(_editor,data.schema.tables)})},$scope.save=function(){$scope.validateParams(),$scope.statement.type="Query";var data={source:$scope.statement};$scope.statement.id?SourceService.update(data,function(){$location.path("/origem/")}):SourceService.save(data,function(){$location.path("/origem/")})},$scope.validateParams=function(){for(var i=0;i<$scope.statement.parameters.length;i++){var param=$scope.statement.parameters[i];""===param.name.trim()&&($scope.statement.parameters.splice(i,1),i--)}},$scope.resetStatement=function(){$scope.statement={parameters:[],sql:"SELECT p.codproduto, p.codbarras, p.descricao1 FROM zw14ppro p WHERE p.situacao = 'N'",limit:100,offset:0},$scope.addParam()},$scope.addParam=function(){$scope.statement.parameters.push({name:"",value:"",type:"varchar",evaluated:!1})},$scope.deleteParam=function(key){$scope.statement.parameters[key]._destroy=!0},isNaN($routeParams.id)?$scope.resetStatement():SourceService.get({id:$routeParams.id},function(data){$scope.statement=data.query})}function AggregationCreateController($scope,$routeParams,$location,SourceService,FunctionService){$scope.data_types=["varchar","decimal","integer","date","time","timestamp"],SourceService.get(function(data){$scope.sourceList=data.sources.filter(function(index){return"Query"===index.type?index:void 0})}),FunctionService.get(function(data){$scope.functionList=data.functions}),$scope.addParam=function(){$scope.aggregation.parameters.push({datatype:"varchar"})},$scope.addExecution=function(){data={function_id:$scope.functionList[0].id,name:$scope.functionList[0].name,parameters:{name:$scope.functionList[0].parameters.name,type:$scope.functionList[0].parameters.type}},$scope.aggregation.executions.push(data)},$scope.addSource=function(){$scope.aggregation.sources.push({})},$scope.deleteParam=function(key){$scope.aggregation.parameters[key]._destroy=!0},$scope.deleteSource=function(key){$scope.aggregation.sources.splice(key,1)},$scope.save=function(){$scope.aggregation.type="Aggregation";var data={source:$scope.aggregation};$scope.aggregation.id?SourceService.update(data,function(){$location.path("/origem/")}):SourceService.save(data,function(){$location.path("/origem/")})},isNaN($routeParams.id)?$scope.aggregation={parameters:[],sources:[],executions:[]}:SourceService.get({id:$routeParams.id},function(data){$scope.aggregation=data.aggregation})}function DashboardDetailController($scope,$routeParams,$interval,DashboardService,SourceService,QueryService,AggregationService,zErrors){function loadDashboard(){DashboardService.get({id:$routeParams.id},function(data){$scope.dashboard=data.dashboard,$scope.dataSourceServer=data.dashboard.data_source_servers[0],$scope.dataSourceServer&&($scope.activeDataSourceServer=$scope.dataSourceServer.id,$scope.loadWidgets())},function(err){$scope.alert={type:"danger",messages:zErrors.handling(err)},$scope.isLoadingWidgets=!1})}$scope.dashboard={},$scope.sourceList=[],$scope.dataSourceServer={},$scope.activeDataSourceServer,$scope.alert={},loadDashboard(),$scope.getStatus=function(result,widget){widget.full_result=result;var x=NumberHelpers.number_to_human(result,{labels:{thousand:"mil",million:"Mi",billion:"Bi",trillion:"Tri"},precision:3,significant:!0,separator:",",delimiter:"."});x=x.split(" "),widget.result=x[0],widget.grandeza=x[1]},$scope.prepareDataset=function(rows){for(var dataSet=[],dataAtual=moment($scope.indicadores.periodo.inicio).format("YYYY-MM-DD"),dataFinal=moment($scope.indicadores.periodo.fim).format("YYYY-MM-DD"),valores={values:[],labels:[],plotBands:[]};dataFinal>=dataAtual;){var row=_.find(rows,function(el){return el[0]===dataAtual});void 0===row&&(row=[dataAtual,0,0,0,0]),dataSet.push(row);var weekDay=moment(dataAtual).format("dd"),timestamp=parseInt(moment(row[0]).format("x"));valores.values.push([timestamp,row[1]]),"sáb"===weekDay&&valores.plotBands.push({from:moment(row[0]).format("x"),to:moment(row[0]).add(1,"day").format("x"),color:"rgba(192, 192, 192, .2)"}),dataAtual=moment(dataAtual).add(1,"day").format("YYYY-MM-DD")}return valores.values=valores.values.sort(function(a,b){return a[0]-b[0]}),valores},$scope.getGraph=function(widget,data){function grafico(valores){return window.dataset=valores.values,chart=new Highcharts.StockChart({colors:[Configuration.colors[widget.color]],title:{text:"<h3>"+title+"</h3>",useHtml:!0,style:{fontFamily:"Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif",fontSize:"19px"}},scrollbar:{enabled:!1},chart:{renderTo:$('[data-behaivor="widget"][data-id='+widget.id+"] .content")[0],zoomType:"x",panning:!0,panKey:"shift",events:{selection:function(event){$("[data-resetbutton]").css("display",event.xAxis?"block":"none")},load:function(){var buttons=this.rangeSelector.buttons;buttons.forEach(function(e){if($(e.element).click(function(){e.state&&3!==e.state&&$("[data-resetbutton]").css("display","block")}),e.state&&3===e.state){var t=e.element.childNodes[1],s="font-weight:normal;color:#FFF;fill:#FFF;";t.setAttribute("style",s),e.attr({opacity:.65})}})}}},navigation:{buttonOptions:{width:120}},navigator:{enabled:!1},credits:{enabled:!1},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},rangeSelector:{buttonTheme:{fill:"#3498DB",width:90,r:0,style:{background:"#3498DB",color:"#FFF"},states:{hover:{fill:"#217DBB",background:"#217DBB",style:{color:"white"}},select:{fill:"#217DBB",style:{color:"white",fontWeight:"normal"}}}},labelStyle:{display:"none"},inputEnabled:!1,buttons:[{type:"month",count:1,text:"1 mês"},{type:"month",count:3,text:"3 meses"},{type:"month",count:6,text:"6 meses"}]},plotOptions:{areaspline:{fillOpacity:.5},series:{states:{hover:{lineWidthPlus:10}}}},xAxis:{type:"datetime",minRange:12096e5,minTickInterval:864e5,plotBands:valores.plotBands,labels:{maxStaggerLines:1},dateTimeLabelFormats:{week:"%d/%b",day:"%d/%b",month:"%b/%Y"}},series:[{type:"areaspline",name:"Contratos",data:valores.values,lineWidth:2,marker:{enabled:!0,radius:3},tooltip:{valueDecimals:2}}]})}var chart,valores=$scope.prepareDataset(data.result.rows),title=widget.customized?widget.name:widget.indicator.name;try{$('[data-behaivor="widget"][data-id='+widget.id+"] .content").highcharts().destroy(),$(document).off("click","[data-resetbutton]")}catch(err){}chart=grafico(valores),$(document).on("click","[data-resetbutton]",function(){chart.zoomOut()})},$scope.getPie=function(widget,data){var colors=["#1abc9c","#2ecc71","#e74c3c","#e67e22","#f1c40f","#3498db","#9b59b6","#34495e","#95a5a6","#ecf0f1"].reverse(),dataset=[],percentual=0,total=0,title=widget.customized?widget.name:widget.indicator.name,serie="Quantidade",enabledTooltip=!0;if(widget.hasData=!0,data.result.rows.length>0){var volumeTotal=0,produtos=data.result.rows.sort(function(a,b){return a[1]>b[1]?-1:a[1]<b[1]?1:0}),produtosLength=produtos.length>=9?9:produtos.length;_.each(produtos,function(widget){volumeTotal+=widget[1]});for(var i=0;produtosLength>i;i++)percentual=100*produtos[i][1]/volumeTotal,dataset.push([$.trim(produtos[i][0].toUpperCase()),percentual]),total+=percentual;dataset.push(["OUTROS",100-total])}else widget.hasData=!1,dataset.push(["",100]),enabledTooltip=!1;$("[data-behaivor=widget][data-id="+widget.id+"] .content").highcharts({colors:colors,chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},legend:!1,plotOptions:{pie:{borderColor:"#FFF",innerSize:"60%",dataLabels:{enabled:!1},states:{hover:{enabled:enabledTooltip}}}},title:{text:title,useHtml:!0},tooltip:{enabled:enabledTooltip,pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},series:[{type:"pie",name:serie,data:dataset}]},function(chart){var xpos="50%",ypos="53%",circleradius=102;chart.renderer.circle(xpos,ypos,circleradius).attr({fill:"#fff"}).add()})},$scope.setActiveDataSourceServer=function(){$scope.dataSourceServer=_.find($scope.dashboard.data_source_servers,function(el){return $scope.activeDataSourceServer===el.id})},$scope.getHost=function(){var url=(new RegExp("https?://(.*:[0-9]{4})","i"),$scope.dataSourceServer.url);return url},$scope.loadWidgets=function(){if($scope.isLoadingWidgets=!0,0===Object.keys($scope.dashboard).length)loadDashboard();else{var widgetsLoaded=0;$scope.dashboard.widgets.forEach(function(widget){widget.loading=!0,SourceService.get({id:widget.indicator.source_id},function(data){$scope.alert={};var Service="Query"===data.query.type?QueryService:AggregationService,parameters="Query"===data.query.type?data.query.parameters:data.aggregation.parameters;_.each(parameters,function(el,index){null!==el.value||"inicio"!==el.name&&"fim"!==el.name||(parameters[index].value="inicio"===el.name?$scope.indicadores.periodo.inicio:$scope.indicadores.periodo.fim)}),Service.post(data,$scope.getHost(),function(data){var type=widget.widget_type.name;switch(type){case"status":$scope.getStatus(data.result.rows[0][0],widget);break;case"line":$scope.getGraph(widget,data);break;case"pie":$scope.getPie(widget,data)}widget.loading=!1,widgetsLoaded++,$scope.isLoadingWidgets=$scope.dashboard.widgets.length==widgetsLoaded?!1:!0})})})}},$scope.indicadores={periodo:{inicio:moment({day:1,month:10,year:2014}).format("YYYY-MM-DD 00:00:00"),fim:moment({day:30,month:10,year:2014}).format("YYYY-MM-DD 00:00:00"),duracao:function(grandeza){var grandeza=grandeza||"days",fim=moment($scope.indicadores.periodo.fim),inicio=moment($scope.indicadores.periodo.inicio),diferenca=fim.diff(inicio,grandeza);return diferenca+1}}}}function DashboardFakeDetailController($scope){data={id:1,name:"Painel de Mecânica",description:"Painel de Mecânica",data_source_servers:[{id:1,url:"http://localhost:3000/api",name:"localhost",description:"localhost",alive:!0}],widgets:[{id:9,customized:!1,name:"Faturamento",description:"Faturamento",color:"green",position:0,size:3,dashboard_id:1,indicator:{id:9,name:"Faturamento",description:"faturamento",code:"faturamento",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"R$"}},widget_type:{id:2,name:"status"}},{id:6,customized:!1,name:"Ticket Médio Peças",description:"Ticket Médio Peças",color:"orange",position:3,size:3,dashboard_id:1,indicator:{id:6,name:"Ticket Médio Peças",description:"ticket_medio_pecas",code:"ticket_medio_pecas",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"R$"}},widget_type:{id:2,name:"status"}},{id:7,customized:!1,name:"Ticket Médio MO",description:"Ticket Médio MO",color:"blue",position:3,size:3,dashboard_id:1,indicator:{id:7,name:"Ticket Médio PO",description:"ticket_medio_mao_de_obra",code:"ticket_medio_mao_de_obra",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"R$"}},widget_type:{id:2,name:"status"}},{id:8,customized:!1,name:"Inadimplência",description:"Inadimplência",color:"red",position:3,size:3,dashboard_id:1,indicator:{id:8,name:"Inadimplência",description:"inadimplencia",code:"inadimplencia",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"%"}},widget_type:{id:2,name:"status"}},{id:1,customized:!1,name:"Rentabilidade Peças",description:"Rentabilidade Peças",color:"purple",position:0,size:3,dashboard_id:1,indicator:{id:1,name:"Rentabilidade Peças",description:"rent_pecas",code:"rent_pecas",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"%"}},widget_type:{id:2,name:"status"}},{id:2,customized:!1,name:"Rentabilidade MO",description:"Rentabilidade MO",color:"purple",position:1,size:3,dashboard_id:1,indicator:{id:2,name:"Rentabilidade MO",description:"rent_mo",code:"rent_mo",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"%"}},widget_type:{id:2,name:"status"}},{id:3,customized:!1,name:"Rentabilidade Terceiros",description:"Rentabilidade Terceiros",color:"purple",position:2,size:3,dashboard_id:1,indicator:{id:3,name:"Rentabilidade Terceiros",description:"rent_terceiros",code:"rent_terceiros",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"%"}},widget_type:{id:2,name:"status"}},{id:4,customized:!1,name:"Rentabilidade MC",description:"Rentabilidade MC",color:"purple",position:3,size:3,dashboard_id:1,indicator:{id:4,name:"Rentabilidade MC",description:"rent_mc",code:"rent_mc",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"%"}},widget_type:{id:2,name:"status"}},{id:5,customized:!1,name:"Novas OS por dia",description:"Novas OS por dia",color:"blue",position:3,size:12,dashboard_id:1,indicator:{id:5,name:"Novas OS por dia",description:"novas_os_dia",code:"novas_os_dia",unity_id:1,source_id:3,unity:{id:1,name:"Moeda",symbol:"%"}},widget_type:{id:2,name:"line"}}]},$scope.dashboard={},$scope.sourceList=[],$scope.dataSourceServer={},$scope.activeDataSourceServer={},$scope.dashboard=data,$scope.dataSourceServer=data.data_source_servers[0],$scope.activeDataSourceServer=$scope.dataSourceServer.id,$scope.getStatus=function(result,widget){x=NumberHelpers.number_to_human(result,{labels:{thousand:"mil",million:"Mi",billion:"Bi",trillion:"Tri"},precision:3,significant:!0,separator:",",delimiter:"."}),x=x.split(" "),widget.result=x[0],widget.grandeza=x[1]},$scope.prepareDataset=function(rows){for(var dataSet=[],dataAtual=moment($scope.indicadores.periodo.inicio).format("YYYY-MM-DD"),dataFinal=moment($scope.indicadores.periodo.fim).format("YYYY-MM-DD"),valores={values:[],labels:[],plotBands:[]};dataFinal>=dataAtual;){var find=_.find(rows,function(el){return el[0]===dataAtual});dataSet.push(void 0===find?[dataAtual,0,0,0,0]:find),dataAtual=moment(dataAtual).add(1,"day").format("YYYY-MM-DD")}return $.each(dataSet,function(el,val){diaSemana=moment(val[0]).format("dd"),valores.values.push([moment(val[0]).format("x"),val[1]]),"sáb"===diaSemana&&valores.plotBands.push({from:moment(val[0]).format("x"),to:moment(val[0]).add(1,"day").format("x"),color:"rgba(192, 192, 192, .2)"})}),valores.values=valores.values.sort(function(a,b){return a[0]-b[0]}),valores},$scope.getGraph=function(widget,data){function grafico(valores){chart=$('[data-behaivor="widget"][data-id='+widget.id+"] .content").highcharts("StockChart",{colors:[Configuration.colors[widget.color]],title:{text:"<h3>"+title+"</h3>",useHtml:!0,style:{fontFamily:"Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif",fontSize:"19px"}},chart:{zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{theme:{fill:"#2c3e50",stroke:"#2c3e50",style:{color:"white"},r:0,states:{hover:{fill:"#1a242f",stroke:"#2c3e50",style:{color:"white",cursor:"pointer"}}}}}},navigation:{buttonOptions:{width:120}},navigator:{enabled:!1},credits:{enabled:!1},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},rangeSelector:{buttonTheme:{width:90,r:0},inputEnabled:!1,selected:1,buttons:[{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"all",text:"Tudo"}]},plotOptions:{areaspline:{fillOpacity:.5},series:{states:{hover:{lineWidthPlus:10}}}},xAxis:{type:"datetime",minRange:12096e5,minTickInterval:864e5,plotBands:valores.plotBands,labels:{maxStaggerLines:1}},series:[{type:"areaspline",name:"Contratos",data:valores.values,lineWidth:2,marker:{enabled:!0,radius:3},tooltip:{valueDecimals:2}}]})
}var valores=$scope.prepareDataset(data.result.rows),title=widget.customized?widget.name:widget.indicator.name;$.each(valores.values,function(index,val){valores.values[index][0]=parseInt(val[0])}),window.setTimeout(function(){grafico(valores)},500)},$scope.getPie=function(widget,data){var colors=["#1abc9c","#2ecc71","#e74c3c","#e67e22","#f1c40f","#3498db","#9b59b6","#34495e","#95a5a6","#ecf0f1"].reverse(),dataset=[],percentual=0,total=0,title=widget.customized?widget.name:widget.indicator.name,serie="Quantidade";if(data.result.rows.length>0){var volumeTotal=0,produtos=data.result.rows.sort(function(a,b){return a[1]>b[1]?-1:a[1]<b[1]?1:0});_.each(produtos,function(widget){volumeTotal+=widget[1]});for(var i=0;9>i;i++)percentual=100*produtos[i][1]/volumeTotal,dataset.push([$.trim(produtos[i][0].toUpperCase()),percentual]),total+=percentual;dataset.push(["OUTROS",100-total])}$("[data-behaivor=widget][data-id="+widget.id+"] .content").highcharts({colors:colors,chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},legend:!1,plotOptions:{pie:{borderColor:"#FFF",innerSize:"60%",dataLabels:{enabled:!1}}},title:{text:title,useHtml:!0},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},series:[{type:"pie",name:serie,data:dataset}]},function(chart){var xpos="50%",ypos="53%",circleradius=102;chart.renderer.circle(xpos,ypos,circleradius).attr({fill:"#fff"}).add()})},$scope.setActiveDataSourceServer=function(){$scope.dataSourceServer=_.find($scope.dashboard.data_source_servers,function(el){return $scope.activeDataSourceServer===el.id})},$scope.getHost=function(){var re=new RegExp("https?://(.*:[0-9]{4})","i"),url=$scope.dataSourceServer.url,x=url.match(re);return x[1]},$scope.loadWidgets=function(){widgets={rent_pecas:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_peca",type:3}],rows:[["0.3714"]]}},rent_mo:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_servico",type:3}],rows:[["1.1396"]]}},rent_mc:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_servico",type:3}],rows:[["0.2845"]]}},rent_terceiros:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_servico",type:3}],rows:[["0.2634"]]}},inadimplencia:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_servico",type:3}],rows:[["1.987"]]}},faturamento:{statement:{records:1,fetched:1,columns:[{name:"faturamento",type:3}],rows:[["103546.5514"]]}},novas_os_dia:{statement:{records:19,fetched:19,columns:[{name:"data_emissao",type:91},{name:"quantidade",type:4}],rows:[["2014-12-01",17],["2014-12-02",20],["2014-12-03",9],["2014-12-04",9],["2014-12-05",5],["2014-12-08",17],["2014-12-09",11],["2014-12-10",6],["2014-12-11",8],["2014-12-12",3],["2014-12-15",15],["2014-12-16",12],["2014-12-17",14],["2014-12-18",9],["2014-12-19",5],["2014-12-22",9],["2014-12-23",12],["2014-12-24",4],["2014-12-29",1]]}},ticket_medio_pecas:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_peca",type:3}],rows:[["1348.4246"]]}},ticket_medio_mao_de_obra:{statement:{records:1,fetched:1,columns:[{name:"faturamento_tipo_item_servico",type:3}],rows:[["1076.4129"]]}}},$scope.isLoadingWidgets=!0,$scope.dashboard.widgets.forEach(function(widget,index){$scope.dashboard.widgets[index].loading=!0;var type=widget.widget_type.name;switch(data=widgets[widget.indicator.code],type){case"status":$scope.getStatus(data.result.rows[0][0],widget);break;case"line":$scope.getGraph(widget,data);break;case"pie":$scope.getPie(widget,data)}$scope.dashboard.widgets[index].loading=!1}),$scope.isLoadingWidgets=!1},$scope.initDaterangepicker=function(){var i=document.createElement("input");i.setAttribute("type","date"),hasInputDate="text"!==i.type,format=hasInputDate?"YYYY-MM-DD":"DD/MM/YYYY",$("#reportrange").daterangepicker({ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 Dias":[moment().subtract(6,"days"),moment()],"Últimos 30 Dias":[moment().subtract(29,"days"),moment()],"Últimos 90 Dias":[moment().subtract(89,"days"),moment()],"Este Mês":[moment().startOf("month"),moment().endOf("month")],"Último Mês":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},format:format,showDropdowns:!0,minDate:moment({year:2e3,month:0,day:1}),maxDate:moment().add(1,"month"),startDate:moment().subtract(29,"days"),endDate:moment(),locale:{applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Para",customRangeLabel:"Personalizado",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Favereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]}},function(start,end,range){var text;if(void 0!==range&&"Personalizado"!==range)text=range;else{var formato="D [de] MMMM";start.format("YYYY")===end.format("YYYY")?start.format("MMMM")===end.format("MMMM")&&(formato="D"):formato="D [de] MMMM, YYYY",text=start.format(formato)+"  até  "+end.format("D [de] MMMM, YYYY")}$("[data-behaivor=show-actual-date]").html(text),$scope.indicadores.periodo.inicio=start.format("YYYY-MM-DD 00:00:00"),$scope.indicadores.periodo.fim=end.format("YYYY-MM-DD 00:00:00"),$scope.loadWidgets()}),$(".daterangepicker").css("width",$("#reportrange").innerWidth()+"px"),hasInputDate&&($("[name=daterangepicker_start]").attr("type","date"),$("[name=daterangepicker_end]").attr("type","date"))},$scope.indicadores={periodo:{inicio:moment({month:11,day:1,year:2014}).format("YYYY-MM-DD 00:00:00"),fim:moment({month:11,day:31,year:2014}).format("YYYY-MM-DD 00:00:00"),duracao:function(grandeza){var grandeza=grandeza||"days",fim=moment($scope.indicadores.periodo.fim),inicio=moment($scope.indicadores.periodo.inicio),diferenca=fim.diff(inicio,grandeza);return diferenca+1}}},$scope.loadWidgets(),$scope.initDaterangepicker()}angular.module("Atlas").controller("AppController",AppController).controller("DataSourceIndexController",DataSourceIndexController).controller("DataSourceCreateController",DataSourceCreateController).controller("DashboardIndexController",DashboardIndexController).controller("DashboardCreateController",DashboardCreateController).controller("IndicatorIndexController",IndicatorIndexController).controller("IndicatorCreateController",IndicatorCreateController).controller("WidgetIndexController",WidgetIndexController).controller("WidgetCreateController",WidgetCreateController).controller("UserIndexController",UserIndexController).controller("UserCreateController",UserCreateController).controller("PermissionIndexController",PermissionIndexController).controller("PermissionCreateController",PermissionCreateController).controller("ModalInstanceCtrl",ModalInstanceCtrl).controller("ConsoleController",ConsoleController).controller("OrigemIndexController",OrigemIndexController).controller("QueryCreateController",QueryCreateController).controller("AggregationCreateController",AggregationCreateController).controller("DashboardsController",DashboardsController).controller("DashboardDetailController",DashboardDetailController).controller("DashboardFakeDetailController",DashboardFakeDetailController),AppController.$inject=["$scope","$rootScope","$location","AuthService","zErrors"],DataSourceIndexController.$inject=["$scope","$location","DataSourceService"],DataSourceCreateController.$inject=["DataSourceService","$scope","$routeParams","$location"],DashboardIndexController.$inject=["$scope","$location","DashboardService"],DashboardCreateController.$inject=["$scope","$routeParams","$location","DashboardService"],IndicatorIndexController.$inject=["$scope","$location","IndicatorService"],IndicatorCreateController.$inject=["$scope","$routeParams","$location","IndicatorService","SourceService","UnityService"],WidgetIndexController.$inject=["$scope","$location","WidgetService"],WidgetCreateController.$inject=["$scope","$routeParams","$location","WidgetService","IndicatorService","DashboardService","WidgetTypeService"],UserIndexController.$inject=["$scope","$location","UserService"],UserCreateController.$inject=["$scope","$routeParams","$location","UserService"],PermissionIndexController.$inject=["$scope","$location","PermissionService"],PermissionCreateController.$inject=["$scope","$routeParams","$location","PermissionService","UserService","DataSourceService","DashboardService"],ConsoleController.$inject=["$scope","$location","$anchorScroll","StatementService","SchemaService","HistoryService","DataSourceService","zCodeMirror","$modal","zErrors"],DashboardsController.$inject=["$scope","$location","DashboardService","QueryService"],OrigemIndexController.$inject=["$scope","$location","SourceService"],QueryCreateController.$inject=["$scope","$routeParams","$location","SourceService","zCodeMirror"],AggregationCreateController.$inject=["$scope","$routeParams","$location","SourceService","FunctionService"],DashboardDetailController.$inject=["$scope","$routeParams","$interval","DashboardService","SourceService","QueryService","AggregationService","zErrors"],DashboardFakeDetailController.$inject=["$scope","$routeParams","$window","DashboardService","SourceService","QueryService","AggregationService"]}(),function(){"use strict";angular.module("Atlas").directive("integer",function(){return{require:"ngModel",link:function(scope,ele,attr,ctrl){ctrl.$parsers.unshift(function(viewValue){return parseInt(viewValue,10)})}}}).directive("scrollPosition",function($window){return{scope:{scroll:"=scrollPosition"},link:function(scope){var windowEl=angular.element($window),handler=function(){scope.scroll=windowEl.scrollTop()};windowEl.on("scroll",scope.$apply.bind(scope,handler)),handler()}}}).directive("zCheckbox",function(){return{restrict:"E",require:"ngModel",scope:{checkbox:"=ngModel"},template:'<div class="atlCheckbox" ng-class="{\'atlCheckbox_checked\' : checkbox }"><input type="checkbox" ng-model="checkbox"></div>',link:function(scope,element){element.on({mouseenter:function(){element.children(1).addClass("atlCheckbox_hover")},focusin:function(){element.children(1).addClass("atlCheckbox_hover")},mouseleave:function(){element.children(1).removeClass("atlCheckbox_hover").removeClass(".atlCheckbox_active")},focusout:function(){element.children(1).removeClass("atlCheckbox_hover")}})}}}).directive("zExecutions",function(){return{restrict:"E",templateUrl:"/dist/templates/origem/zExecutions.html",link:function($scope){$scope.move=function(key,dir){$scope.aggregation.executions.map(function(elem,index){return elem.order=index,elem});for(var aux,i=0;i<$scope.aggregation.executions.length;i++){var index="down"===dir?i+1:i-1;key===i&&(aux=$scope.aggregation.executions[i],$scope.aggregation.executions[i]=$scope.aggregation.executions[index],$scope.aggregation.executions[index]=aux)}},$scope.deleteExecution=function(key){window.confirm("Você tem certeza que deseja deletar essa operação?")&&($scope.aggregation.executions[key].id?$scope.aggregation.executions[key]._destroy=!0:$scope.aggregation.executions.splice(key,1))},$scope.loadParametersFromFunction=function(execution){for(var i=0,fn=!1;i<$scope.functionList.length||fn===!1;)$scope.functionList[i].id===execution.function_id&&(fn=$scope.functionList[i]),i++;execution.parameters=fn.parameters}}}}).directive("zWidgetStatus",function(){return{restrict:"E",replace:!0,templateUrl:"/dist/templates/widget/tplStatus.html",link:function(){}}}).directive("zLoader",function(){return{restrict:"E",replace:!0,templateUrl:"/dist/templates/directives/zLoader.html",scope:{inverse:"="},link:function($scope){console.log($scope)}}}).directive("zWidgetLine",function(){return{restrict:"E",templateUrl:"/dist/templates/widget/tplLine.html",link:function(){}}}).directive("zWidgetPie",function(){return{restrict:"E",templateUrl:"/dist/templates/widget/tplPie.html",link:function(){}}}).directive("zFloatthead",["$timeout",function($timeout){return{scope:{results:"=ngModel"},require:"ngModel",restrict:"EA",templateUrl:"/dist/templates/directives/zFloatThead.html",link:function($scope,iElm){function loadFloatThead(){$table=iElm.find(".floatThead"),$table.floatThead("destroy"),$timeout(function(){$table.floatThead({scrollContainer:function($table){return $table.closest(".wrapper")}})},500)}$scope.$watch("results",function(value){var records=value.records||0;records>0&&loadFloatThead()})}}}]).directive("zDaterangepicker",[function(){return{scope:{indicadores:"=ngModel",loadWidgets:"&callback"},require:"ngModel",restrict:"EA",link:function(scope,el){function verifyInputDate(){var i=document.createElement("input");return i.setAttribute("type","date"),"text"!==i.type}function callbackDatePicker(start,end,range){var text;if(void 0!==range&&"Personalizado"!==range)text=range;else{var formato="D [de] MMMM";start.format("YYYY")===end.format("YYYY")?start.format("MMMM")===end.format("MMMM")&&(formato="D"):formato="D [de] MMMM, YYYY",text=start.format(formato)+"  até  "+end.format("D [de] MMMM, YYYY")}$("[data-behaivor=show-actual-date]").html(text),scope.indicadores&&(scope.indicadores.periodo.inicio=start.format("YYYY-MM-DD 00:00:00"),scope.indicadores.periodo.fim=end.format("YYYY-MM-DD 00:00:00")),"function"==typeof scope.loadWidgets&&scope.loadWidgets()}var hasInputDate=verifyInputDate(),format=hasInputDate?"YYYY-MM-DD":"DD/MM/YYYY";el.daterangepicker({ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 Dias":[moment().subtract(6,"days"),moment()],"Últimos 30 Dias":[moment().subtract(29,"days"),moment()],"Últimos 90 Dias":[moment().subtract(89,"days"),moment()],"Este Mês":[moment().startOf("month"),moment().endOf("month")],"Último Mês":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},format:format,showDropdowns:!0,minDate:moment({year:2e3,month:0,day:1}),maxDate:moment().add(1,"month"),startDate:moment().subtract(29,"days"),endDate:moment(),locale:{applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Para",customRangeLabel:"Personalizado",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Favereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]}},callbackDatePicker),$(".daterangepicker").css("width",$(el).closest(".toolbar").innerWidth()-30+"px"),hasInputDate&&($("[name=daterangepicker_start]").attr("type","date"),$("[name=daterangepicker_end]").attr("type","date"))}}}]).directive("fastRepeat",["$timeout",function($timeout){return{restrict:"E",scope:{data:"="},link:function(scope,el){function loadFloatThead(records){records>0&&$timeout(function(){var $table=$(".table-float-thead");$table.floatThead("destroy"),$table.floatThead({scrollContainer:function($table){return $table.closest(".wrapper")}})},100)}scope.$watchCollection("data",function(newValue){if(newValue){var records=newValue.records||0;React.render(RTable(newValue),el[0],loadFloatThead(records))}}),el.on("$destroy",function(){var $table=el.find(".table-float-thead");$table.floatThead("destroy")})}}}]).factory("zCodeMirror",function(){var zCodeMirror={};return zCodeMirror.initialize=function($scope){return{lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete",F8:function(){$scope.executeQuery()},"Ctrl-S":function(){$scope.saveHistory()},"Ctrl-Enter":function(){$scope.executeQuery()},"Ctrl-L":function(e){function autoFormat(){var sql=e.doc.getValue();$.ajax({url:"http://sqlformat.org/api/v1/format",type:"POST",dataType:"json",crossDomain:!0,data:{sql:sql,reindent:1},success:function(data){e.doc.setValue(data.result)}})}autoFormat()}},tabSize:2,tabMode:"spaces",styleActiveLine:!1,matchBrackets:!0,mode:"text/x-sql",viewportMargin:1/0}},zCodeMirror.setHints=function(instance,tables){var tables=tables?tables:JSON.parse(localStorage.getItem("tables"));return instance.setOption("hintOptions",{tables:tables})},zCodeMirror}).directive("zAlertbox",[function(){return{scope:{alert:"=ngModel"},require:"ngModel",restrict:"EA",templateUrl:"/dist/templates/directives/zAlertbox.html",link:function($scope){$scope.clearMessages=function(){$scope.alert={type:"",messages:[]}}}}}])}(),function(){"use strict";angular.module("Atlas").service("zHttp",["$http",function($http){var http={url:"",req:{method:"GET",url:"http://localhost:3000",data:{}},setParams:function(method,data,server){"undefined"!=typeof method&&this.setMethod(method),"undefined"!=typeof data&&this.setData(data),"undefined"!=typeof server&&this.setServer(server)},setMethod:function(method){this.req.method=method},get:function(data,server){var self=this;return self.setParams("GET",data,server),$http(self.req)},post:function(data,server,callback){var self=this;return self.setParams("POST",data,server),$http(self.req).success(callback)},setServer:function(server){var self=this;server="/"!==server.substr(-1)?server:server.substr(0,server.length-1),"undefined"!=typeof self.req.data.id&&(self.url+="/"+self.req.data.id),$.extend(self.req,{url:server+self.url})},setData:function(data){var self=this;$.extend(self.req,{data:data})}};return http}]).factory("QueryService",["zHttp",function(zHttp){var x=Object.create(zHttp);return x.url="/api/queries",x}]).factory("AggregationService",["zHttp",function(zHttp){var x=Object.create(zHttp);return x.url="/api/aggretations",x}]).factory("DataSourceService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/data_source_servers/:id",{id:"@data_source_server.id"},{update:{method:"PUT"}})}]).factory("SourceService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/sources/:id",{id:"@source.id"},{update:{method:"PUT"}})}]).factory("UnityService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/unities/:id",{id:"@unitiy.id"},{update:{method:"PUT"}})}]).factory("AuthService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/authentications/:id",{id:"@authentication.id"},{update:{method:"PUT"}})}]).factory("DashboardService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/dashboards/:id",{id:"@dashboard.id"},{update:{method:"PUT"}})}]).factory("IndicatorService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/indicators/:id",{id:"@indicator.id"},{update:{method:"PUT"}})}]).factory("WidgetService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/widgets/:id",{id:"@widget.id"},{update:{method:"PUT"}})}]).factory("UserService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/users/:id",{id:"@user.id"},{update:{method:"PUT"}})}]).factory("PermissionService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/permissions/:id",{id:"@permission.id"},{update:{method:"PUT"}})}]).factory("WidgetTypeService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/widget_types/:id",{id:"@widget_types.id"},{update:{method:"PUT"}})}]).factory("SchemaService",["$resource",function($resource){return $resource("http://prod-01:4567/api/schema/extended")}]).factory("StatementService",["$http",function($http){var Statement={req:{method:"POST",url:"htpp://localhost:3000",data:{}},execute:function(data,server){var self=this;return self.setServer(server),self.setData(data),$http(self.req)},setServer:function(server){var self=this;$.extend(self.req,{url:server+"/api/statements"})},setData:function(data){var self=this;$.extend(self.req,{data:data})}};return Statement}]).factory("FunctionService",["$resource",function($resource){return $resource(Configuration.business_server+"/api/functions")}]).factory("HistoryService",function(){var History={};return History.get=function(id,callback){var id=id||!1,items=JSON.parse(localStorage.getItem("history"))||[];if("function"==typeof id&&(callback=id,id=!1),id){for(var item=!1,i=0;i<items.length&&item===!1;)items[i].id===id&&(item=items[i]),i++;return item}callback(items)},History.post=function(statement,callback){var id=parseInt(16777215*Math.random(),10).toString(16),history=JSON.parse(localStorage.getItem("history"))||[],type=statement.sql.match(/^\s*(SELECT|DELETE|UPDATE|INSERT|DROP|CREATE)\b/i)[1].toUpperCase()||"",item={id:id,statement:statement,created_at:new Date,type:type};history.push(item),localStorage.setItem("history",JSON.stringify(history)),callback()},History.clear=function(callback){localStorage.removeItem("history"),callback()},History["delete"]=function(id,callback){for(var items=JSON.parse(localStorage.getItem("history"))||[],item=!1,i=0;i<items.length&&item===!1;)void 0!=items[i]&&items[i].id===id&&(items.splice(i,1),item=!0),i++;localStorage.setItem("history",JSON.stringify(items)),callback(items)},History})}();
//# sourceMappingURL=../sourcemap.map